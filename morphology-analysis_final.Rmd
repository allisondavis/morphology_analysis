---
title: "morphology-analysis_final"
author: "Allison Davis Connelly"
date: "9/21/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## *Morphological variation of amazon and sailfin mollies* {.tabset .tabset-fade .tabset-pills}

In this study, I am looking at various populations of amazon and sailfin mollies across their native/introduced range to assess morphological variation both within and among the species. I am using the Pickle fish collections for my samples.

### Data collection {.tabset .tabset-fade .tabset-pills}

```{r, echo=FALSE}
library(curl)

raw <- curl("https://raw.githubusercontent.com/allisondavis/morphology_analysis/master/adavis_morphology_raw-data.csv")

raw <- read.csv(raw, header = TRUE, sep = ",", stringsAsFactors = TRUE)

head(raw)

raw1 <- raw[complete.cases(raw[, 8:29]),]


lat <- raw[raw$SPP == "p.latipinna",]
head(lat)

form <- raw[raw$SPP == "p.formosa",]
head(form)

lat.1 <- lat[complete.cases(lat[, 8:29]),]
form.1 <- form[complete.cases(form[, 8:29]),]

```
#### Summary data {.tabset .tabset-fade .tabset-pills}

Here I will calculate the means for each of the traits between the amazons and sailfin. I will then perform a t-test to compare means (recognizing that nothing is corrected for size here).


```{r}

tt_D <- t.test(lat.1$D, form.1$D, alternative = "two.sided")
tt_P1 <- t.test(lat.1$P1, form.1$P1, alternative = "two.sided")
tt_P2.L <- t.test(lat.1$P2.L, form.1$P2.L, alternative = "two.sided")
tt_P2.R <- t.test(lat.1$P2.R, form.1$P2.R, alternative = "two.sided")
tt_A <- t.test(lat.1$A, form.1$A, alternative = "two.sided")
tt_P1.R <- t.test(lat.1$P1.R, form.1$P1.R, alternative = "two.sided")
tt_LLSC <- t.test(lat.1$LLSC, form.1$LLSC, alternative = "two.sided")
tt_SALL <- t.test(lat.1$SALL, form.1$SALL, alternative = "two.sided")
tt_SBLL <- t.test(lat.1$SBLL, form.1$SBLL, alternative = "two.sided")
tt_SBDF <- t.test(lat.1$SBDF, form.1$SBDF, alternative = "two.sided")
tt_TL <- t.test(lat.1$TL, form.1$TL, alternative = "two.sided")
tt_SL <- t.test(lat.1$SL, form.1$SL, alternative = "two.sided")
tt_BD <- t.test(lat.1$BD, form.1$BD, alternative = "two.sided")
tt_CPD <- t.test(lat.1$CPD, form.1$CPD, alternative = "two.sided")
tt_CPL <- t.test(lat.1$CPL, form.1$CPL, alternative = "two.sided")
tt_PreDL <- t.test(lat.1$PreDL, form.1$PreDL, alternative = "two.sided")
tt_DbL <- t.test(lat.1$DbL, form.1$DbL, alternative = "two.sided")
tt_HL <- t.test(lat.1$HL, form.1$HL, alternative = "two.sided")
tt_HW <- t.test(lat.1$HW, form.1$HW, alternative = "two.sided")
tt_HD <- t.test(lat.1$HD, form.1$HD, alternative = "two.sided")
tt_SnL <- t.test(lat.1$SnL, form.1$SnL, alternative = "two.sided")
tt_OL <- t.test(lat.1$OL, form.1$OL, alternative = "two.sided")


avg_comp <- matrix(c(mean(lat.1$D), mean(form.1$D), tt_D$p.value, mean(lat.1$P1), mean(form.1$P1), tt_P1$p.value, mean(lat.1$P2.L), mean(form.1$P2.L), tt_P2.L$p.value, mean(lat.1$P2.R), mean(form.1$P2.R), tt_P2.R$p.value,  mean(lat.1$A), mean(form.1$A), tt_A$p.value, mean(lat.1$P1.R), mean(form.1$P1.R), tt_P1.R$p.value, mean(lat.1$LLSC), mean(form.1$LLSC), tt_LLSC$p.value, mean(lat.1$SALL), mean(form.1$SALL), tt_SALL$p.value, mean(lat.1$SBLL), mean(form.1$SBLL), tt_SBLL$p.value, mean(lat.1$SBDF), mean(form.1$SBDF), tt_SBDF$p.value, mean(lat.1$TL), mean(form.1$TL), tt_TL$p.value, mean(lat.1$SL), mean(form.1$SL), tt_SL$p.value, mean(lat.1$BD), mean(form.1$BD), tt_BD$p.value, mean(lat.1$CPD), mean(form.1$CPD), tt_CPD$p.value, mean(lat.1$CPL), mean(form.1$CPL), tt_CPL$p.value, mean(lat.1$PreDL), mean(form.1$PreDL), tt_PreDL$p.value, mean(lat.1$DbL), mean(form.1$DbL), tt_DbL$p.value, mean(lat.1$HL), mean(form.1$HL), tt_HL$p.value, mean(lat.1$HW), mean(form.1$HW), tt_HW$p.value, mean(lat.1$HD), mean(form.1$HD), tt_HD$p.value, mean(lat.1$SnL), mean(form.1$SnL), tt_SnL$p.value, mean(lat.1$OL), mean(form.1$OL), tt_OL$p.value), ncol=3, byrow = TRUE)

colnames(avg_comp)<- c('Lat mean', 'Form mean', 't-test p-value')

rownames(avg_comp) <- c('dorsal rays', 'L pect rays', 'L pelvic rays', 'R pelvic rays', 'Anal rays', 'R pect rays', 'lat line scales', 'scales above LL', 'scales below LL', 'scales before dor', 'total len', 'standard len', 'body dep', 'peduncle dep', 'peduncle leng', 'pre-dorsal', 'dorsal base', 'head length',  'head width', 'head depth', 'snout leng', 'orbital leng')

avg_comp

```





### PCA analysis {.tabset .tabset-fade .tabset-pills}

In this analysis, I will compare the principle components after centering and scaling the data. A PCA analysis will help us determine what aspects of morphology influence the variation in our data the most without worrying about differences in scales/measurements. Currently, data consists of **33 Sailfin and 73 Amazon**. (34 sailfin and 78 Amazon including NAs)

***Will use the original raw data set rather than any outlier-removed data sets.***

*Variable chart:*

  - D: dorsal ray count
  - P1: left pectoral ray count
  - P2.L: left pelvic rays
  - P2.R: right pelvic rays
  - A: anal rays
  - P1.R: right pectoral ray count
  - LLSC: lateral line scale count
  - SALL: scales above lateral line
  - SBLL: scales below lateral line
  - SBDF: scales before dorsal fin
  - TL: total length
  - SL: standard length
  - BD: body depth
  - CPD: caudal peduncle depth
  - CPL: caudal peduncle length
  - PreDL: pre-dorsal length
  - DbL: dorsal base length
  - HL/HW/HD: head length/width/depth
  - SnL: snout length
  - OL: ocular length

-   summary of PCs

```{r, echo=FALSE}

PCA2 <- prcomp(raw1[, 8:29], center=TRUE, scale. = TRUE) #includes all 22 traits 
summary(PCA2)
loadings <- PCA2$rotation
loadings[, 1:5]

VM_PCA <- varimax(PCA2$rotation)
summary(VM_PCA)

```

-   visualization of PCA

```{r, echo=FALSE}

library(AMR)
library(ggplot2)


library(ggfortify)

plot6<- autoplot(PCA2, data = raw1, colour='SPP', loadings=TRUE, loadings.colour='navyblue', loadings.label=TRUE, loadings.label.colour='navyblue', loadings.label.size=5, loadings.label.vjust= 1, loadings.label.hjust= 1.2, frame=TRUE, frame.type='norm')+ ggtitle("PCA Plot of Morphology traits") + theme_minimal()
plot6

raw.lat <- raw1[raw1$SPP == "p.latipinna",]
raw.form <- raw1[raw1$SPP == "p.formosa",]

plot7<- autoplot(PCA2, data = raw1, colour='COUNTY.ST', shape="SPP", frame=TRUE, frame.type='norm')+ ggtitle("PCA Plot of Morphology traits") + theme_minimal()
plot7
#don't think this is actually useful. Would this be telling me that populations would be different?


#Let's try this was PC2 and 3, since 1 is mostly size anyways.

plot8<- autoplot(PCA2, x=2, y=3, data = raw1, colour='SPP', loadings=TRUE, loadings.colour='navyblue', loadings.label=TRUE, loadings.label.colour='navyblue', loadings.label.size=5, loadings.label.vjust= 1, loadings.label.hjust= 1.2, frame=TRUE, frame.type='norm')+ ggtitle("PCA Plot of Morphology traits") + theme_minimal()
plot8

raw.lat <- raw1[raw1$SPP == "p.latipinna",]
raw.form <- raw1[raw1$SPP == "p.formosa",]

plot9<- autoplot(PCA2, x=2, y=3, data = raw1, colour='COUNTY.ST', shape="SPP", frame=TRUE, frame.type='norm')+ ggtitle("PCA Plot of Morphology traits") + theme_minimal()
plot9



```

*Variable chart:*

  - D: dorsal ray count
  - P1: left pectoral ray count
  - P2.L: left pelvic rays
  - P2.R: right pelvic rays
  - A: anal rays
  - P1.R: right pectoral ray count
  - LLSC: lateral line scale count
  - SALL: scales above lateral line
  - SBLL: scales below lateral line
  - SBDF: scales before dorsal fin
  - TL: total length
  - SL: standard length
  - BD: body depth
  - CPD: caudal peduncle depth
  - CPL: caudal peduncle length
  - PreDL: pre-dorsal length
  - DbL: dorsal base length
  - HL/HW/HD: head length/width/depth
  - SnL: snout length
  - OL: ocular length
  
  
  
### T and F tests (body size corrected) {.tabset .tabset-fade .tabset-pills}

F tests on residuals doesn't make much sense; the residuals themselves are representative of the variation present, as they are the distance from the mean. Therefore, F tests on residuals is like variance of the variance. Instead, I have to do a t-test on the absolute value of the residuals. In this sense, we want to see if the mean of the absolute residuals is higher or lower for asexual species--is the average amount of variation higher or lower for this trait? What I need to do is first compare the absolute value of the residuals using a t-test; if the r2 for the regression plot of SL vs trait is not significant, than this suggests it does not vary with body size. I can then do the regular F tests on those traits.

So: 
    1. Plot regression of trait by SD for both species and all traits. Get r2 values and their associated p values.
    2. Get the absolute value of the residual scores.
    3. Plot the mean absolute values of the residuals for both species (with raw data) for each trait.
    4. Run a t-test for the absolute values of the residuals for all traits.
    5. Backtrack: if r2 is not significant from (1), then use F tests on raw data.

#### Calculated residuals {.tabset .tabset-fade .tabset-pills}


I will now use residuals to account for body size in each trait, and compare the variance for each species. Again, the first round will take the raw residuals, and the second round with use the absolute value of the raw residuals.

##### Regressions {.tabset .tabset-fade .tabset-pills}

-   STEP ONE: plot trait vs body size

```{r}

library(ggplot2)
library(ggpubr)

lat.1 <- lat[complete.cases(lat[, 8:29]),]
form.1 <- form[complete.cases(form[, 8:29]),]

#previously performed regression with SL on y and trait on x; corrected the code below to have SL on x and trait on y; kept a copy of the old version for the D trait just to show there is no difference

reg.lat.D1 <- lm(lat.1$D ~ lat.1$SL)
reg.lat.D1.plot <- ggplot(lat.1, aes(x = SL, y = D)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.D1.plot

reg.lat.P11 <- lm(lat.1$P1 ~ lat.1$SL)
reg.lat.P11.plot <- ggplot(lat.1, aes(x = SL, y = P1)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.P11.plot

reg.lat.P2.L1 <- lm(lat.1$P2.L ~ lat.1$SL)
reg.lat.P2.L1.plot <- ggplot(lat.1, aes(x = SL, y = P2.L)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.P2.L1.plot

reg.lat.P2.R1 <- lm(lat.1$P2.R ~ lat.1$SL)
reg.lat.P2.R1.plot <- ggplot(lat.1, aes(x = SL, y = P2.R)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.P2.R1.plot

reg.lat.A1 <- lm(lat.1$A ~ lat.1$SL)
reg.lat.A1.plot <- ggplot(lat.1, aes(x = SL, y = A)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.A1.plot

reg.lat.P1.R1 <- lm(lat.1$P1.R ~ lat.1$SL)
reg.lat.P1.R1.plot <- ggplot(lat.1, aes(x = SL, y = P1.R)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.P1.R1.plot

reg.lat.LLSC1 <- lm(lat.1$LLSC ~ lat.1$SL)
reg.lat.LLSC1.plot <- ggplot(lat.1, aes(x = SL, y = LLSC)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.LLSC1.plot

reg.lat.SALL1 <- lm(lat.1$SALL ~ lat.1$SL)
reg.lat.SALL1.plot <- ggplot(lat.1, aes(x = SL, y = SALL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.SALL1.plot

reg.lat.SBLL1 <- lm(lat.1$SBLL ~ lat.1$SL)
reg.lat.SBLL1.plot <- ggplot(lat.1, aes(x = SL, y = SBLL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.SBLL1.plot

reg.lat.SBDF1 <- lm(lat.1$SBDF ~ lat.1$SL)
reg.lat.SBDF1.plot <- ggplot(lat.1, aes(x = SL, y = SBDF)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.SBDF1.plot

reg.lat.BD1 <- lm(lat.1$BD ~ lat.1$SL)
reg.lat.BD1.plot <- ggplot(lat.1, aes(x = SL, y = BD)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.BD1.plot

reg.lat.CPD1 <- lm(lat.1$CPD ~ lat.1$SL)
reg.lat.CPD1.plot <- ggplot(lat.1, aes(x = SL, y = CPD)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.CPD1.plot

reg.lat.CPL1 <- lm(lat.1$CPL ~ lat.1$SL)
reg.lat.CPL1.plot <- ggplot(lat.1, aes(x = SL, y = CPL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.CPL1.plot

reg.lat.PreDL1 <- lm(lat.1$PreDL ~ lat.1$SL)
reg.lat.PreDL1.plot <- ggplot(lat.1, aes(x = SL, y = PreDL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.PreDL1.plot

reg.lat.DbL1 <- lm(lat.1$DbL ~ lat.1$SL)
reg.lat.DbL1.plot <- ggplot(lat.1, aes(x = SL, y = DbL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.DbL1.plot

reg.lat.HL1 <- lm(lat.1$HL ~ lat.1$SL)
reg.lat.HL1.plot <- ggplot(lat.1, aes(x = SL, y = HL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.HL1.plot

reg.lat.HD1 <- lm(lat.1$HD ~ lat.1$SL)
reg.lat.HD1.plot <- ggplot(lat.1, aes(x = SL, y = HD)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.HD1.plot

reg.lat.HW1 <- lm(lat.1$HW ~ lat.1$SL)
reg.lat.HW1.plot <- ggplot(lat.1, aes(x = SL, y = HW)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.HW1.plot

reg.lat.SnL1 <- lm(lat.1$SnL ~ lat.1$SL)
reg.lat.SnL1.plot <- ggplot(lat.1, aes(x = SL, y = SnL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.SnL1.plot

reg.lat.OL1 <- lm(lat.1$OL ~ lat.1$SL)
reg.lat.OL1.plot <- ggplot(lat.1, aes(x = SL, y = OL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.OL1.plot



reg.form.D1 <- lm(form.1$D ~ form.1$SL)
reg.form.D1.plot <- ggplot(form.1, aes(x =SL, y = D)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.D1.plot

reg.form.P11 <- lm(form.1$P1 ~ form.1$SL)
reg.form.P11.plot <- ggplot(form.1, aes(x = SL, y = P1)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.P11.plot

reg.form.P2.L1 <- lm(form.1$P2.L ~ form.1$SL)
reg.form.P2.L1.plot <- ggplot(form.1, aes(x = SL, y = P2.L)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.P2.L1.plot

reg.form.P2.R1 <- lm(form.1$P2.R ~ form.1$SL)
reg.form.P2.R1.plot <- ggplot(form.1, aes(x = SL, y = P2.R)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.P2.R1.plot

reg.form.A1 <- lm(form.1$A ~ form.1$SL)
reg.form.A1.plot <- ggplot(form.1, aes(x = SL, y = A)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.A1.plot

reg.form.P1.R1 <- lm(form.1$P1.R ~ form.1$SL)
reg.form.P1.R1.plot <- ggplot(form.1, aes(x = SL, y = P1.R)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.P1.R1.plot

reg.form.LLSC1 <- lm(form.1$LLSC ~ form.1$SL)
reg.form.LLSC1.plot <- ggplot(form.1, aes(x = SL, y = LLSC)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.LLSC1.plot

reg.form.SALL1 <- lm(form.1$SALL ~ form.1$SL)
reg.form.SALL1.plot <- ggplot(form.1, aes(x = SL, y = SALL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.SALL1.plot

reg.form.SBLL1 <- lm(form.1$SBLL ~ form.1$SL)
reg.form.SBLL1.plot <- ggplot(form.1, aes(x = SL, y = SBLL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.SBLL1.plot

reg.form.SBDF1 <- lm(form.1$SBDF ~ form.1$SL)
reg.form.SBDF1.plot <- ggplot(form.1, aes(x = SL, y = SBDF)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.SBDF1.plot

reg.form.BD1 <- lm(form.1$BD ~ form.1$SL)
reg.form.BD1.plot <- ggplot(form.1, aes(x = SL, y = BD)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.BD1.plot

reg.form.CPD1 <- lm(form.1$CPD ~ form.1$SL)
reg.form.CPD1.plot <- ggplot(form.1, aes(x = SL, y = CPD)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.CPD1.plot

reg.form.CPL1 <- lm(form.1$CPL ~ form.1$SL)
reg.form.CPL1.plot <- ggplot(form.1, aes(x = SL, y = CPL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.CPL1.plot

reg.form.PreDL1 <- lm(form.1$PreDL ~ form.1$SL)
reg.form.PreDL1.plot <- ggplot(form.1, aes(x = SL, y = PreDL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.PreDL1.plot

reg.form.DbL1 <- lm(form.1$DbL ~ form.1$SL)
reg.form.DbL1.plot <- ggplot(form.1, aes(x = SL, y = DbL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.DbL1.plot

reg.form.HL1 <- lm(form.1$HL ~ form.1$SL)
reg.form.HL1.plot <- ggplot(form.1, aes(x = SL, y = HL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.HL1.plot

reg.form.HD1 <- lm(form.1$HD ~ form.1$SL)
reg.form.HD1.plot <- ggplot(form.1, aes(x = SL, y = HD)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.HD1.plot

reg.form.HW1 <- lm(form.1$HW ~ form.1$SL)
reg.form.HW1.plot <- ggplot(form.1, aes(x = SL, y = HW)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.HW1.plot

reg.form.SnL1 <- lm(form.1$SnL ~ form.1$SL)
reg.form.SnL1.plot <- ggplot(form.1, aes(x = SL, y = SnL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.SnL1.plot

reg.form.OL1 <- lm(form.1$OL ~ form.1$SL)
reg.form.OL1.plot <- ggplot(form.1, aes(x = SL, y = OL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.OL1.plot


```

**ALL BUT P2.R, P2.L, AND SBDF WERE SIGNIFICANT FOR ONE OR BOTH SPECIES**


##### Residuals {.tabset .tabset-fade .tabset-pills}

-   STEP TWO: get residuals for each individual for that trait

```{r echo=FALSE}
res.lat.D1 <- resid(reg.lat.D1)

res.lat.P11 <- resid(reg.lat.P11)

res.lat.P1.R1 <- resid(reg.lat.P1.R1)

res.lat.A1 <- resid(reg.lat.A1)

res.lat.LLSC1 <- resid(reg.lat.LLSC1)

res.lat.SALL1 <- resid(reg.lat.SALL1)

res.lat.SBLL1 <- resid(reg.lat.SBLL1)

res.lat.BD1 <- resid(reg.lat.BD1)

res.lat.CPD1 <- resid(reg.lat.CPD1)

res.lat.CPL1 <- resid(reg.lat.CPL1)

res.lat.PreDL1 <- resid(reg.lat.PreDL1)

res.lat.DbL1 <- resid(reg.lat.DbL1)

res.lat.HL1 <- resid(reg.lat.HL1)

res.lat.HD1 <- resid(reg.lat.HD1)

res.lat.HW1 <- resid(reg.lat.HW1)

res.lat.SnL1 <- resid(reg.lat.SnL1)

res.lat.OL1 <- resid(reg.lat.OL1)


res.form.D1 <- resid(reg.form.D1)

res.form.P11 <- resid(reg.form.P11)

res.form.P1.R1 <- resid(reg.form.P1.R1)

res.form.A1 <- resid(reg.form.A1)

res.form.LLSC1 <- resid(reg.form.LLSC1)

res.form.SALL1 <- resid(reg.form.SALL1)

res.form.SBLL1 <- resid(reg.form.SBLL1)

res.form.BD1 <- resid(reg.form.BD1)

res.form.CPD1 <- resid(reg.form.CPD1)

res.form.CPL1 <- resid(reg.form.CPL1)

res.form.PreDL1 <- resid(reg.form.PreDL1)

res.form.DbL1 <- resid(reg.form.DbL1)

res.form.HL1 <- resid(reg.form.HL1)

res.form.HD1 <- resid(reg.form.HD1)

res.form.HW1 <- resid(reg.form.HW1)

res.form.SnL1 <- resid(reg.form.SnL1)

res.form.OL1 <- resid(reg.form.OL1)

```

-   STEP THREE: convert residuals to absolute value

```{r}
abs.lat.D1 <- abs(res.lat.D1)
mean(abs.lat.D1)

abs.lat.P11 <- abs(res.lat.P11)
mean(abs.lat.P11)

abs.lat.P1.R1 <- abs(res.lat.P1.R1)
mean(abs.lat.P1.R1)

abs.lat.A1 <- abs(res.lat.A1)
mean(abs.lat.A1)

abs.lat.LLSC1 <- abs(res.lat.LLSC1)
mean(abs.lat.LLSC1)

abs.lat.SALL1 <- abs(res.lat.SALL1)
mean(abs.lat.SALL1)

abs.lat.SBLL1 <- abs(res.lat.SBLL1)
mean(abs.lat.SBLL1)

abs.lat.BD1 <- abs(res.lat.BD1)
mean(abs.lat.BD1)

abs.lat.CPD1 <- abs(res.lat.CPD1)
mean(abs.lat.CPD1)

abs.lat.CPL1 <- abs(res.lat.CPL1)
mean(abs.lat.CPL1)

abs.lat.PreDL1 <- abs(res.lat.PreDL1)
mean(abs.lat.PreDL1)

abs.lat.DbL1 <- abs(res.lat.DbL1)
mean(abs.lat.DbL1)

abs.lat.HL1 <- abs(res.lat.HL1)
mean(abs.lat.HL1)

abs.lat.HD1 <- abs(res.lat.HD1)
mean(abs.lat.HD1)

abs.lat.HW1 <- abs(res.lat.HW1)
mean(abs.lat.HW1)

abs.lat.SnL1 <- abs(res.lat.SnL1)
mean(abs.lat.SnL1)

abs.lat.OL1 <- abs(res.lat.OL1)
mean(abs.lat.OL1)


abs.form.D1 <- abs(res.form.D1)
mean(abs.form.D1)

abs.form.P11 <- abs(res.form.P11)
mean(abs.form.P11)

abs.form.P1.R1 <- abs(res.form.P1.R1)
mean(abs.form.P1.R1)

abs.form.A1 <- abs(res.form.A1)
mean(abs.form.A1)

abs.form.LLSC1 <- abs(res.form.LLSC1)
mean(abs.form.LLSC1)

abs.form.SALL1 <- abs(res.form.SALL1)
mean(abs.form.SALL1)

abs.form.SBLL1 <- abs(res.form.SBLL1)
mean(abs.form.SBLL1)

abs.form.BD1 <- abs(res.form.BD1)
mean(abs.form.BD1)

abs.form.CPD1 <- abs(res.form.CPD1)
mean(abs.form.CPD1)

abs.form.CPL1 <- abs(res.form.CPL1)
mean(abs.form.CPL1)

abs.form.PreDL1 <- abs(res.form.PreDL1)
mean(abs.form.PreDL1)

abs.form.DbL1 <- abs(res.form.DbL1)
mean(abs.form.DbL1)

abs.form.HL1 <- abs(res.form.HL1)
mean(abs.form.HL1)

abs.form.HD1 <- abs(res.form.HD1)
mean(abs.form.HD1)

abs.form.HW1 <- abs(res.form.HW1)
mean(abs.form.HW1)

abs.form.SnL1 <- abs(res.form.SnL1)
mean(abs.form.SnL1)

abs.form.OL1 <- abs(res.form.OL1)
mean(abs.form.OL1)



#let's get this into the raw1 data set so that we can plot this more easily

abs.res.D <- append(abs.lat.D1, abs.form.D1)
abs.res.P1 <- append(abs.lat.P11, abs.form.P11)
abs.res.A <- append(abs.lat.A1, abs.form.A1)
abs.res.P1.R <- append(abs.lat.P1.R1, abs.form.P1.R1)
abs.res.LLSC<- append(abs.lat.LLSC1, abs.form.LLSC1)
abs.res.SALL <- append(abs.lat.SALL1, abs.form.SALL1)
abs.res.SBLL<- append(abs.lat.SBLL1, abs.form.SBLL1)
abs.res.BD<- append(abs.lat.BD1, abs.form.BD1)
abs.res.CPD<- append(abs.lat.CPD1, abs.form.CPD1)
abs.res.CPL<- append(abs.lat.CPL1, abs.form.CPL1)
abs.res.PreDL <- append(abs.lat.PreDL1, abs.form.PreDL1)
abs.res.DbL <- append(abs.lat.DbL1, abs.form.DbL1)
abs.res.HL<- append(abs.lat.HL1, abs.form.HL1)
abs.res.HD<- append(abs.lat.HD1, abs.form.HD1)
abs.res.HW <- append(abs.lat.HW1, abs.form.HW1)
abs.res.SnL <- append(abs.lat.SnL1, abs.form.SnL1)
abs.res.OL <- append(abs.lat.OL1, abs.form.OL1)

raw3 <- cbind(raw1, abs.res.D, abs.res.P1, abs.res.P1.R, abs.res.A, abs.res.LLSC, abs.res.SALL, abs.res.SBLL, abs.res.BD, abs.res.CPD, abs.res.CPL, abs.res.PreDL, abs.res.DbL, abs.res.HL, abs.res.HD, abs.res.HW, abs.res.SnL, abs.res.OL)


```


##### Residual Comparisons {.tabset .tabset-fade .tabset-pills}



-   STEP FOUR: plot the mean of the |residuals| for both species, for all traits

```{r}

library(ggbeeswarm)
library(dplyr)


ggplot(raw3, aes(SPP, abs.res.D)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)


scatter_violin <- ggplot(data=raw3, aes(x=SPP, y=abs.res.D)) +
  geom_violin(trim = FALSE) + 
  stat_summary(
    fun.data = "mean_sdl",  fun.args = list(mult = 1),
    geom = "pointrange", color = "black"
    )

print(scatter_violin)

scatter_violin1 <- ggplot(data=raw3, aes(x=SPP, y=abs.res.D)) +
  geom_violin(trim = FALSE) + 
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="crossbar", fill="red", width=0.03)

print(scatter_violin1)



ggplot(raw3, aes(SPP, abs.res.P1)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw3, aes(SPP, abs.res.P1.R)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3) 

ggplot(raw3, aes(SPP, abs.res.A)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw3, aes(SPP, abs.res.LLSC)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw3, aes(SPP, abs.res.SALL)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw3, aes(SPP, abs.res.SBLL)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw3, aes(SPP, abs.res.BD)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw3, aes(SPP, abs.res.CPD)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw3, aes(SPP, abs.res.CPL)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3) 

ggplot(raw3, aes(SPP, abs.res.PreDL)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw3, aes(SPP, abs.res.DbL)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw3, aes(SPP, abs.res.HL)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw3, aes(SPP, abs.res.HD)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw3, aes(SPP, abs.res.HW)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw3, aes(SPP, abs.res.SnL)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw3, aes(SPP, abs.res.OL)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)




```



#### F tests to compare species {.tabset .tabset-fade .tabset-pills}

    -   will do two-tailed and check out the means to infer direction (see beginning for trait means w/o body correction)
    -   this will only be for the traits that did not have a significant regression compared to SL 

```{r, echo=FALSE}


var.left.pel <- var.test(lat.1$P2.L, form.1$P2.L, alternative = "two.sided")
var.left.pel

var.rig.pel <- var.test(lat.1$P2.R, form.1$P2.R, alternative = "two.sided")
var.rig.pel

var.sca.df <- var.test(lat.1$SBDF, form.1$SBDF, alternative = "two.sided")
var.sca.df



```






<br><br><br><br>




#### T tests to compare species {.tabset .tabset-fade .tabset-pills}


   -    will do two-tailed and check out the means to infer direction (see beginning for trait means w/o body correction)
   -    this will be for the traits that *did* have a significant regression compared to SL; will be using the absolute value residuals. 
    


```{r, echo=FALSE}


ttest.abs.D1 <- t.test(abs.lat.D1, abs.form.D1, alternative = "two.sided")
ttest.abs.D1


ttest.abs.P11 <- t.test(abs.lat.P11, abs.form.P11, alternative = "two.sided")
ttest.abs.P11


ttest.abs.P1.R1 <- t.test(abs.lat.P1.R1, abs.form.P1.R1, alternative = "two.sided")
ttest.abs.P1.R1


ttest.abs.A1 <- t.test(abs.lat.A1, abs.form.A1, alternative = "two.sided")
ttest.abs.A1


ttest.abs.LLSC1 <- t.test(abs.lat.LLSC1, abs.form.LLSC1, alternative = "two.sided")
ttest.abs.LLSC1


ttest.abs.SALL1 <- t.test(abs.lat.SALL1, abs.form.SALL1, alternative = "two.sided")
ttest.abs.SALL1


ttest.abs.SBLL1 <- t.test(abs.lat.SBLL1, abs.form.SBLL1, alternative = "two.sided")
ttest.abs.SBLL1


ttest.abs.BD1 <- t.test(abs.lat.BD1, abs.form.BD1, alternative = "two.sided")
ttest.abs.BD1


ttest.abs.CPD1 <- t.test(abs.lat.CPD1, abs.form.CPD1, alternative = "two.sided")
ttest.abs.CPD1


ttest.abs.CPL1 <- t.test(abs.lat.CPL1, abs.form.CPL1, alternative = "two.sided")
ttest.abs.CPL1


ttest.abs.PreDL1 <- t.test(abs.lat.PreDL1, abs.form.PreDL1, alternative = "two.sided")
ttest.abs.PreDL1


ttest.abs.DbL1 <- t.test(abs.lat.DbL1, abs.form.DbL1, alternative = "two.sided")
ttest.abs.DbL1


ttest.abs.HL1 <- t.test(abs.lat.HL1, abs.form.HL1, alternative = "two.sided")
ttest.abs.HL1


ttest.abs.HD1 <- t.test(abs.lat.HD1, abs.form.HD1, alternative = "two.sided")
ttest.abs.HD1


ttest.abs.HW1 <- t.test(abs.lat.HW1, abs.form.HW1, alternative = "two.sided")
ttest.abs.HW1


ttest.abs.SnL1 <- t.test(abs.lat.SnL1, abs.form.SnL1, alternative = "two.sided")
ttest.abs.SnL1


ttest.abs.OL1 <- t.test(abs.lat.OL1, abs.form.OL1, alternative = "two.sided")
ttest.abs.OL1




```




#### Summary of variance results {.tabset .tabset-fade .tabset-pills}


```{r}

average.table <- matrix(c(ttest.abs.D1$p.value, mean(abs.lat.D1), mean(abs.form.D1), ttest.abs.P11$p.value, mean(abs.lat.P11), mean(abs.form.P11), var.rig.pel$p.value, mean(lat.1$P2.R), mean(form.1$P2.R), var.left.pel$p.value, mean(lat.1$P2.L), mean(form.1$P2.L), ttest.abs.A1$p.value, mean(abs.lat.A1), mean(abs.form.A1), ttest.abs.P1.R1$p.value, mean(abs.lat.P1.R1), mean(abs.form.P1.R1), ttest.abs.LLSC1$p.value, mean(abs.lat.LLSC1), mean(abs.form.LLSC1), ttest.abs.SALL1$p.value, mean(abs.lat.SALL1), mean(abs.form.SALL1), ttest.abs.SBLL1$p.value, mean(abs.lat.SBLL1), mean(abs.form.SBLL1), var.sca.df$p.value, mean(lat.1$SBDF), mean(form.1$SBDF), ttest.abs.BD1$p.value, mean(abs.lat.BD1), mean(abs.form.BD1), ttest.abs.CPD1$p.value, mean(abs.lat.CPD1), mean(abs.form.CPD1), ttest.abs.CPL1$p.value, mean(abs.lat.CPL1), mean(abs.form.CPL1), ttest.abs.PreDL1$p.value, mean(abs.lat.PreDL1), mean(abs.form.PreDL1), ttest.abs.DbL1$p.value, mean(abs.lat.DbL1), mean(abs.form.DbL1), ttest.abs.HL1$p.value, mean(abs.lat.HL1), mean(abs.form.HL1), ttest.abs.HD1$p.value, mean(abs.lat.HD1), mean(abs.form.HD1), ttest.abs.HW1$p.value, mean(abs.lat.HW1), mean(abs.form.HW1), ttest.abs.SnL1$p.value, mean(abs.lat.SnL1), mean(abs.form.SnL1), ttest.abs.OL1$p.value, mean(abs.lat.OL1), mean(abs.form.OL1)), ncol=3, byrow=TRUE)

colnames(average.table)<- c('p-value for variance', 'lat mean', 'form mean')

rownames(average.table) <- c('dorsal rays', 'L pect rays', 'R pelvic rays*', 'L pelvic rays*', 'Anal rays', 'R pect rays', 'lat line scales', 'scales above LL', 'scales below LL', 'scales before dor*', 'body dep', 'peduncle dep', 'peduncle leng', 'pre-dorsal', 'dorsal base', 'head lengtt', 'head depth', 'head width', 'snout leng', 'orbital leng')

average.table


```



<br><br><br><br>