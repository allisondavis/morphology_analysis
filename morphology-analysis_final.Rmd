---
title: "morphology-analysis_final"
author: "Allison Davis Connelly"
date: "9/21/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## *Morphological variation of amazon and sailfin mollies* {.tabset .tabset-fade .tabset-pills}

In this study, I am looking at various populations of amazon and sailfin mollies across their native/introduced range to assess morphological variation both within and among the species. I am using the Pickle fish collections for my samples.

### Data collection {.tabset .tabset-fade .tabset-pills}

```{r, echo=FALSE}
library(curl)

raw <- curl("https://raw.githubusercontent.com/allisondavis/morphology_analysis/master/adavis_morphology_raw-data_NEAR-FINAL.csv")

raw <- read.csv(raw, header = TRUE, sep = ",", stringsAsFactors = TRUE)

head(raw)

#raw1 <- raw[complete.cases(raw[, 8:29]),] dont think I want to do this; just use remove NA for specific functions to not remove too much data


#lat.1 <- lat[complete.cases(lat[, 8:29]),] SEE COMMENT ABOVE
#form <- form[complete.cases(form[, 8:29]),]


#to test for fluctuating asymmetries, I want to create a column that illustrates the difference between P1 L & R

FLA <- (abs((raw$P1)-(raw$P1.R)))+1
raw1 <- cbind(raw, FLA)

lat <- raw1[raw1$SPP == "p.latipinna",]
head(lat)

form <- raw1[raw1$SPP == "p.formosa",]
head(form)

```
#### Summary data {.tabset .tabset-fade .tabset-pills}

Here I will calculate the means for each of the traits between the amazons and sailfin. I will then perform a t-test to compare means (recognizing that nothing is corrected for size here).


```{r}

tt_D <- t.test(lat$D, form$D, alternative = "two.sided", na.action=na.omit)
tt_P1 <- t.test(lat$P1, form$P1, alternative = "two.sided", na.action=na.omit)
#tt_P2.L <- t.test(lat$P2.L, form$P2.L, alternative = "two.sided", na.action=na.omit) REMOVED SINCE IT NEVER CHANGED (ALL WERE 6-6 IN BOTH SPECIES)
#tt_P2.R <- t.test(lat$P2.R, form$P2.R, alternative = "two.sided", na.action=na.omit)
tt_A <- t.test(lat$A, form$A, alternative = "two.sided", na.action=na.omit)
tt_P1.R <- t.test(lat$P1.R, form$P1.R, alternative = "two.sided", na.action=na.omit)
tt_LLSC <- t.test(lat$LLSC, form$LLSC, alternative = "two.sided", na.action=na.omit)
tt_SALL <- t.test(lat$SALL, form$SALL, alternative = "two.sided", na.action=na.omit)
tt_SBLL <- t.test(lat$SBLL, form$SBLL, alternative = "two.sided", na.action=na.omit)
tt_SBDF <- t.test(lat$SBDF, form$SBDF, alternative = "two.sided", na.action=na.omit)
tt_TL <- t.test(lat$TL, form$TL, alternative = "two.sided", na.action=na.omit)
tt_SL <- t.test(lat$SL, form$SL, alternative = "two.sided", na.action=na.omit)
tt_BD <- t.test(lat$BD, form$BD, alternative = "two.sided", na.action=na.omit)
tt_CPD <- t.test(lat$CPD, form$CPD, alternative = "two.sided", na.action=na.omit)
tt_CPL <- t.test(lat$CPL, form$CPL, alternative = "two.sided", na.action=na.omit)
tt_PreDL <- t.test(lat$PreDL, form$PreDL, alternative = "two.sided", na.action=na.omit)
tt_DbL <- t.test(lat$DbL, form$DbL, alternative = "two.sided", na.action=na.omit)
tt_HL <- t.test(lat$HL, form$HL, alternative = "two.sided", na.action=na.omit)
tt_HW <- t.test(lat$HW, form$HW, alternative = "two.sided", na.action=na.omit)
tt_HD <- t.test(lat$HD, form$HD, alternative = "two.sided", na.action=na.omit)
tt_SnL <- t.test(lat$SnL, form$SnL, alternative = "two.sided", na.action=na.omit)
tt_OL <- t.test(lat$OL, form$OL, alternative = "two.sided", na.action=na.omit)
tt_FLA <- t.test(lat$FLA, form$FLA, alternative = "two.sided", na.action=na.omit)


avg_comp <- matrix(c(mean(lat$D, na.rm = TRUE), mean(form$D, na.rm = TRUE), tt_D$p.value, mean(lat$P1, na.rm = TRUE), mean(form$P1, na.rm = TRUE), tt_P1$p.value,  mean(lat$A, na.rm = TRUE), mean(form$A, na.rm = TRUE), tt_A$p.value, mean(lat$P1.R, na.rm = TRUE), mean(form$P1.R, na.rm = TRUE), tt_P1.R$p.value, mean(lat$LLSC, na.rm = TRUE), mean(form$LLSC, na.rm = TRUE), tt_LLSC$p.value, mean(lat$SALL, na.rm = TRUE), mean(form$SALL, na.rm = TRUE), tt_SALL$p.value, mean(lat$SBLL, na.rm = TRUE), mean(form$SBLL, na.rm = TRUE), tt_SBLL$p.value, mean(lat$SBDF, na.rm = TRUE), mean(form$SBDF, na.rm = TRUE), tt_SBDF$p.value, mean(lat$TL, na.rm = TRUE), mean(form$TL, na.rm = TRUE), tt_TL$p.value, mean(lat$SL, na.rm = TRUE), mean(form$SL, na.rm = TRUE), tt_SL$p.value, mean(lat$BD, na.rm = TRUE), mean(form$BD, na.rm = TRUE), tt_BD$p.value, mean(lat$CPD, na.rm = TRUE), mean(form$CPD, na.rm = TRUE), tt_CPD$p.value, mean(lat$CPL, na.rm = TRUE), mean(form$CPL, na.rm = TRUE), tt_CPL$p.value, mean(lat$PreDL, na.rm = TRUE), mean(form$PreDL, na.rm = TRUE), tt_PreDL$p.value, mean(lat$DbL, na.rm = TRUE), mean(form$DbL, na.rm = TRUE), tt_DbL$p.value, mean(lat$HL, na.rm = TRUE), mean(form$HL, na.rm = TRUE), tt_HL$p.value, mean(lat$HW, na.rm = TRUE), mean(form$HW, na.rm = TRUE), tt_HW$p.value, mean(lat$HD, na.rm = TRUE), mean(form$HD, na.rm = TRUE), tt_HD$p.value, mean(lat$SnL, na.rm = TRUE), mean(form$SnL, na.rm = TRUE), tt_SnL$p.value, mean(lat$OL, na.rm = TRUE), mean(form$OL, na.rm = TRUE), tt_OL$p.value, mean(lat$FLA, na.rm = TRUE), mean(form$FLA, na.rm = TRUE), tt_FLA$p.value), ncol=3, byrow = TRUE)

colnames(avg_comp)<- c('Lat mean', 'Form mean', 't-test p-value')

rownames(avg_comp) <- c('dorsal rays', 'L pect rays',  'Anal rays', 'R pect rays', 'lat line scales', 'scales above LL', 'scales below LL', 'scales before dor', 'total len', 'standard len', 'body dep', 'peduncle dep', 'peduncle leng', 'pre-dorsal', 'dorsal base', 'head length',  'head width', 'head depth', 'snout leng', 'orbital leng', 'asymmetries, pect')

avg_comp

```





### PCA analysis {.tabset .tabset-fade .tabset-pills}

In this analysis, I will compare the principle components after centering and scaling the data. A PCA analysis will help us determine what aspects of morphology influence the variation in our data the most without worrying about differences in scales/measurements. Currently, data consists of **116 Sailfin and 186 Amazon**. 



*Variable chart:*

  - D: dorsal ray count
  - P1: left pectoral ray count
  - P2.L: left pelvic rays
  - P2.R: right pelvic rays
  - A: anal rays
  - P1.R: right pectoral ray count
  - LLSC: lateral line scale count
  - SALL: scales above lateral line
  - SBLL: scales below lateral line
  - SBDF: scales before dorsal fin
  - TL: total length
  - SL: standard length
  - BD: body depth
  - CPD: caudal peduncle depth
  - CPL: caudal peduncle length
  - PreDL: pre-dorsal length
  - DbL: dorsal base length
  - HL/HW/HD: head length/width/depth
  - SnL: snout length
  - OL: ocular length

-   summary of PCs

```{r, echo=FALSE}

#keeps giving an error about infinite or missing values, even when I do na.omit. Will try with a dataframe that already omits NAs

raw2 <- raw1[complete.cases(raw1[, 10:31]),] #that worked!

#also want the FLA to be in there so gonna try to move the column to 31

moveme <- function (invec, movecommand) {
  movecommand <- lapply(strsplit(strsplit(movecommand, ";")[[1]], 
                                 ",|\\s+"), function(x) x[x != ""])
  movelist <- lapply(movecommand, function(x) {
    Where <- x[which(x %in% c("before", "after", "first", 
                              "last")):length(x)]
    ToMove <- setdiff(x, Where)
    list(ToMove, Where)
  })
  myVec <- invec
  for (i in seq_along(movelist)) {
    temp <- setdiff(myVec, movelist[[i]][[1]])
    A <- movelist[[i]][[2]][1]
    if (A %in% c("before", "after")) {
      ba <- movelist[[i]][[2]][2]
      if (A == "before") {
        after <- match(ba, temp) - 1
      }
      else if (A == "after") {
        after <- match(ba, temp)
      }
    }
    else if (A == "first") {
      after <- 0
    }
    else if (A == "last") {
      after <- length(myVec)
    }
    myVec <- append(temp, values = movelist[[i]][[1]], after = after)
  }
  myVec
}

raw3 <- raw2[moveme(names(raw2), "FLA before SPP")] #is useful, but not sure if I want it in the PCA, especially if I already use the pect counts

PCA <- prcomp(raw2[, 10:31], center=TRUE, scale. = TRUE) #includes all 22 traits 
summary(PCA)
loadings <- PCA$rotation
loadings[, 1:5]


VM_PCA <- varimax(PCA$rotation)
summary(VM_PCA)

```

-   visualization of PCA

```{r, echo=FALSE}

library(AMR)
library(ggplot2)


library(ggfortify)

evplot <- function(ev)
{
	# Broken stick model (MacArthur 1957)
	n <- length(ev)
	bsm <- data.frame(j=seq(1:n), p=0)
	bsm$p[1] <- 1/n
	for (i in 2:n) bsm$p[i] <- bsm$p[i-1] + (1/(n + 1 - i))
	bsm$p <- 100*bsm$p/n
	# Plot eigenvalues and % of variation for each axis
	op <- par(mfrow=c(2,1))
	barplot(ev, main="Eigenvalues", col="bisque", las=2)
	abline(h=mean(ev), col="red")
	legend("topright", "Average eigenvalue", lwd=1, col=2, bty="n")
	barplot(t(cbind(100*ev/sum(ev), bsm$p[n:1])), beside=TRUE, 
		main="% variation", col=c("bisque",2), las=2)
	legend("topright", c("% eigenvalue", "Broken stick model"), 
		pch=15, col=c("bisque",2), bty="n")
	par(op)
}

ev <- PCA$sdev^2
evplot(ev) #according to Kaiser-Guttman criteron, we can use the first 4 PCs, even though the broken stick model shows only the first above the red bar plot... not 100% confident I know what this means, but pretty sure PC1 is body size 

plot6<- autoplot(PCA, data = raw2, colour='SPP', loadings=TRUE, loadings.colour='navyblue', loadings.label=TRUE, loadings.label.colour='navyblue', loadings.label.size=5, loadings.label.vjust= 1, loadings.label.hjust= 1.2, frame=TRUE, frame.type='norm')+ ggtitle("PCA Plot of Morphology traits") + theme_minimal()
plot6

#raw.lat <- raw1[raw1$SPP == "p.latipinna",] no idea what these were for
#raw.form <- raw1[raw1$SPP == "p.formosa",]

plot7<- autoplot(PCA, data = raw2, colour='COUNTY.ST', shape="SPP", frame=TRUE, frame.type='norm')+ ggtitle("PCA Plot of Morphology traits") + theme_minimal()
plot7
#don't think this is actually useful. Would this be telling me that populations would be different?


#Let's try this was PC2 and 3, since 1 is mostly size anyways.

plot8<- autoplot(PCA, x=2, y=3, data = raw2, colour='SPP', loadings=TRUE, loadings.colour='navyblue', loadings.label=TRUE, loadings.label.colour='navyblue', loadings.label.size=5, loadings.label.vjust= 1, loadings.label.hjust= 1.2, frame=TRUE, frame.type='norm')+ ggtitle("PCA Plot of Morphology traits") + theme_minimal()
plot8

plot8.1<- autoplot(PCA, x=2, y=3, data = raw2, colour='SPP', loadings=FALSE, loadings.label=FALSE, frame=TRUE, frame.type='norm')+ ggtitle("PCA Plot of Morphology traits") + theme_minimal()
plot8.1


plot9<- autoplot(PCA, x=2, y=3, data = raw2, colour='COUNTY.ST', shape="SPP", frame=TRUE, frame.type='norm')+ ggtitle("PCA Plot of Morphology traits") + theme_minimal()
plot9





```

*Variable chart:*

  - D: dorsal ray count
  - P1: left pectoral ray count
  - P2.L: left pelvic rays
  - P2.R: right pelvic rays
  - A: anal rays
  - P1.R: right pectoral ray count
  - LLSC: lateral line scale count
  - SALL: scales above lateral line
  - SBLL: scales below lateral line
  - SBDF: scales before dorsal fin
  - TL: total length
  - SL: standard length
  - BD: body depth
  - CPD: caudal peduncle depth
  - CPL: caudal peduncle length
  - PreDL: pre-dorsal length
  - DbL: dorsal base length
  - HL/HW/HD: head length/width/depth
  - SnL: snout length
  - OL: ocular length
  
  
  
### T and F tests (body size corrected) {.tabset .tabset-fade .tabset-pills}

F tests on residuals doesn't make much sense; the residuals themselves are representative of the variation present, as they are the distance from the mean. Therefore, F tests on residuals is like variance of the variance. Instead, I have to do a t-test on the absolute value of the residuals. In this sense, we want to see if the mean of the absolute residuals is higher or lower for asexual species--is the average amount of variation higher or lower for this trait? What I need to do is first compare the absolute value of the residuals using a t-test; if the r2 for the regression plot of SL vs trait is not significant, than this suggests it does not vary with body size. I can then do the regular F tests on those traits.

So: 
    1. Plot regression of trait by SL for both species and all traits. Get r2 values and their associated p values.
    2. Get the absolute value of the residual scores.
    3. Plot the mean absolute values of the residuals for both species (with raw data) for each trait.
    4. Run a t-test for the absolute values of the residuals for all traits.
    5. Backtrack: if r2 is not significant from (1), then use F tests on raw data.

#### Calculated residuals {.tabset .tabset-fade .tabset-pills}


I will now use residuals to account for body size in each trait, and compare the variance for each species. Again, the first round will take the raw residuals, and the second round with use the absolute value of the raw residuals.

##### Regressions {.tabset .tabset-fade .tabset-pills}

-   STEP ONE: plot trait vs body size

```{r}

library(ggplot2)
library(ggpubr)

lat1 <- lat[complete.cases(lat[, 10:31]),]
form1 <- form[complete.cases(form[, 10:31]),]

#previously performed regression with SL on y and trait on x; corrected the code below to have SL on x and trait on y

reg.lat.D1 <- lm(lat1$D ~ lat1$SL)
reg.lat.D1.plot <- ggplot(lat1, aes(x = SL, y = D)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.D1.plot

reg.lat.P11 <- lm(lat1$P1 ~ lat1$SL)
reg.lat.P11.plot <- ggplot(lat1, aes(x = SL, y = P1)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.P11.plot

reg.lat.P2.L1 <- lm(lat1$P2.L ~ lat1$SL)
reg.lat.P2.L1.plot <- ggplot(lat1, aes(x = SL, y = P2.L)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.P2.L1.plot

reg.lat.P2.R1 <- lm(lat1$P2.R ~ lat1$SL)
reg.lat.P2.R1.plot <- ggplot(lat1, aes(x = SL, y = P2.R)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.P2.R1.plot

reg.lat.A1 <- lm(lat1$A ~ lat1$SL)
reg.lat.A1.plot <- ggplot(lat1, aes(x = SL, y = A)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.A1.plot

reg.lat.P1.R1 <- lm(lat1$P1.R ~ lat1$SL)
reg.lat.P1.R1.plot <- ggplot(lat1, aes(x = SL, y = P1.R)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.P1.R1.plot

reg.lat.LLSC1 <- lm(lat1$LLSC ~ lat1$SL)
reg.lat.LLSC1.plot <- ggplot(lat1, aes(x = SL, y = LLSC)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.LLSC1.plot

reg.lat.SALL1 <- lm(lat1$SALL ~ lat1$SL)
reg.lat.SALL1.plot <- ggplot(lat1, aes(x = SL, y = SALL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.SALL1.plot

reg.lat.SBLL1 <- lm(lat1$SBLL ~ lat1$SL)
reg.lat.SBLL1.plot <- ggplot(lat1, aes(x = SL, y = SBLL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.SBLL1.plot

reg.lat.SBDF1 <- lm(lat1$SBDF ~ lat1$SL)
reg.lat.SBDF1.plot <- ggplot(lat1, aes(x = SL, y = SBDF)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.SBDF1.plot

reg.lat.BD1 <- lm(lat1$BD ~ lat1$SL)
reg.lat.BD1.plot <- ggplot(lat1, aes(x = SL, y = BD)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.BD1.plot

reg.lat.CPD1 <- lm(lat1$CPD ~ lat1$SL)
reg.lat.CPD1.plot <- ggplot(lat1, aes(x = SL, y = CPD)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.CPD1.plot

reg.lat.CPL1 <- lm(lat1$CPL ~ lat1$SL)
reg.lat.CPL1.plot <- ggplot(lat1, aes(x = SL, y = CPL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.CPL1.plot

reg.lat.PreDL1 <- lm(lat1$PreDL ~ lat1$SL)
reg.lat.PreDL1.plot <- ggplot(lat1, aes(x = SL, y = PreDL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.PreDL1.plot

reg.lat.DbL1 <- lm(lat1$DbL ~ lat1$SL)
reg.lat.DbL1.plot <- ggplot(lat1, aes(x = SL, y = DbL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.DbL1.plot

reg.lat.HL1 <- lm(lat1$HL ~ lat1$SL)
reg.lat.HL1.plot <- ggplot(lat1, aes(x = SL, y = HL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.HL1.plot

reg.lat.HD1 <- lm(lat1$HD ~ lat1$SL)
reg.lat.HD1.plot <- ggplot(lat1, aes(x = SL, y = HD)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.HD1.plot

reg.lat.HW1 <- lm(lat1$HW ~ lat1$SL)
reg.lat.HW1.plot <- ggplot(lat1, aes(x = SL, y = HW)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.HW1.plot

reg.lat.SnL1 <- lm(lat1$SnL ~ lat1$SL)
reg.lat.SnL1.plot <- ggplot(lat1, aes(x = SL, y = SnL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.SnL1.plot

reg.lat.OL1 <- lm(lat1$OL ~ lat1$SL)
reg.lat.OL1.plot <- ggplot(lat1, aes(x = SL, y = OL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.OL1.plot

reg.lat.FLA <- lm(lat1$FLA ~ lat1$SL)
reg.lat.FLA.plot <- ggplot(lat1, aes(x = SL, y = FLA)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.FLA.plot



reg.form.D1 <- lm(form1$D ~ form1$SL)
reg.form.D1.plot <- ggplot(form1, aes(x =SL, y = D)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.D1.plot

reg.form.P11 <- lm(form1$P1 ~ form1$SL)
reg.form.P11.plot <- ggplot(form1, aes(x = SL, y = P1)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.P11.plot

reg.form.P2.L1 <- lm(form1$P2.L ~ form1$SL)
reg.form.P2.L1.plot <- ggplot(form1, aes(x = SL, y = P2.L)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.P2.L1.plot

reg.form.P2.R1 <- lm(form1$P2.R ~ form1$SL)
reg.form.P2.R1.plot <- ggplot(form1, aes(x = SL, y = P2.R)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.P2.R1.plot

reg.form.A1 <- lm(form1$A ~ form1$SL)
reg.form.A1.plot <- ggplot(form1, aes(x = SL, y = A)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.A1.plot

reg.form.P1.R1 <- lm(form1$P1.R ~ form1$SL)
reg.form.P1.R1.plot <- ggplot(form1, aes(x = SL, y = P1.R)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.P1.R1.plot

reg.form.LLSC1 <- lm(form1$LLSC ~ form1$SL)
reg.form.LLSC1.plot <- ggplot(form1, aes(x = SL, y = LLSC)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.LLSC1.plot

reg.form.SALL1 <- lm(form1$SALL ~ form1$SL)
reg.form.SALL1.plot <- ggplot(form1, aes(x = SL, y = SALL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.SALL1.plot

reg.form.SBLL1 <- lm(form1$SBLL ~ form1$SL)
reg.form.SBLL1.plot <- ggplot(form1, aes(x = SL, y = SBLL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.SBLL1.plot

reg.form.SBDF1 <- lm(form1$SBDF ~ form1$SL)
reg.form.SBDF1.plot <- ggplot(form1, aes(x = SL, y = SBDF)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.SBDF1.plot

reg.form.BD1 <- lm(form1$BD ~ form1$SL)
reg.form.BD1.plot <- ggplot(form1, aes(x = SL, y = BD)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.BD1.plot

reg.form.CPD1 <- lm(form1$CPD ~ form1$SL)
reg.form.CPD1.plot <- ggplot(form1, aes(x = SL, y = CPD)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.CPD1.plot

reg.form.CPL1 <- lm(form1$CPL ~ form1$SL)
reg.form.CPL1.plot <- ggplot(form1, aes(x = SL, y = CPL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.CPL1.plot

reg.form.PreDL1 <- lm(form1$PreDL ~ form1$SL)
reg.form.PreDL1.plot <- ggplot(form1, aes(x = SL, y = PreDL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.PreDL1.plot

reg.form.DbL1 <- lm(form1$DbL ~ form1$SL)
reg.form.DbL1.plot <- ggplot(form1, aes(x = SL, y = DbL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.DbL1.plot

reg.form.HL1 <- lm(form1$HL ~ form1$SL)
reg.form.HL1.plot <- ggplot(form1, aes(x = SL, y = HL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.HL1.plot

reg.form.HD1 <- lm(form1$HD ~ form1$SL)
reg.form.HD1.plot <- ggplot(form1, aes(x = SL, y = HD)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.HD1.plot

reg.form.HW1 <- lm(form1$HW ~ form1$SL)
reg.form.HW1.plot <- ggplot(form1, aes(x = SL, y = HW)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.HW1.plot

reg.form.SnL1 <- lm(form1$SnL ~ form1$SL)
reg.form.SnL1.plot <- ggplot(form1, aes(x = SL, y = SnL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.SnL1.plot

reg.form.OL1 <- lm(form1$OL ~ form1$SL)
reg.form.OL1.plot <- ggplot(form1, aes(x = SL, y = OL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.OL1.plot

reg.form.FLA <- lm(form1$FLA ~ form1$SL)
reg.form.FLA.plot <- ggplot(form1, aes(x = SL, y = FLA)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.FLA.plot


```

**ALL BUT P2, A, SALL, SBDF, and FLA WERE SIGNIFICANT FOR ONE OR BOTH SPECIES**


##### Residuals {.tabset .tabset-fade .tabset-pills}

-   STEP TWO: get residuals for each individual for that trait

```{r echo=FALSE}
res.lat.D1 <- resid(reg.lat.D1)

res.lat.P11 <- resid(reg.lat.P11)

res.lat.P1.R1 <- resid(reg.lat.P1.R1)

res.lat.LLSC1 <- resid(reg.lat.LLSC1)

res.lat.SBLL1 <- resid(reg.lat.SBLL1)

res.lat.BD1 <- resid(reg.lat.BD1)

res.lat.CPD1 <- resid(reg.lat.CPD1)

res.lat.CPL1 <- resid(reg.lat.CPL1)

res.lat.PreDL1 <- resid(reg.lat.PreDL1)

res.lat.DbL1 <- resid(reg.lat.DbL1)

res.lat.HL1 <- resid(reg.lat.HL1)

res.lat.HD1 <- resid(reg.lat.HD1)

res.lat.HW1 <- resid(reg.lat.HW1)

res.lat.SnL1 <- resid(reg.lat.SnL1)

res.lat.OL1 <- resid(reg.lat.OL1)


res.form.D1 <- resid(reg.form.D1)

res.form.P11 <- resid(reg.form.P11)

res.form.P1.R1 <- resid(reg.form.P1.R1)

res.form.LLSC1 <- resid(reg.form.LLSC1)

res.form.SBLL1 <- resid(reg.form.SBLL1)

res.form.BD1 <- resid(reg.form.BD1)

res.form.CPD1 <- resid(reg.form.CPD1)

res.form.CPL1 <- resid(reg.form.CPL1)

res.form.PreDL1 <- resid(reg.form.PreDL1)

res.form.DbL1 <- resid(reg.form.DbL1)

res.form.HL1 <- resid(reg.form.HL1)

res.form.HD1 <- resid(reg.form.HD1)

res.form.HW1 <- resid(reg.form.HW1)

res.form.SnL1 <- resid(reg.form.SnL1)

res.form.OL1 <- resid(reg.form.OL1)

```

-   STEP THREE: convert residuals to absolute value

```{r}
abs.lat.D1 <- abs(res.lat.D1)
mean(abs.lat.D1)

abs.lat.P11 <- abs(res.lat.P11)
mean(abs.lat.P11)

abs.lat.P1.R1 <- abs(res.lat.P1.R1)
mean(abs.lat.P1.R1)

abs.lat.LLSC1 <- abs(res.lat.LLSC1)
mean(abs.lat.LLSC1)

abs.lat.SBLL1 <- abs(res.lat.SBLL1)
mean(abs.lat.SBLL1)

abs.lat.BD1 <- abs(res.lat.BD1)
mean(abs.lat.BD1)

abs.lat.CPD1 <- abs(res.lat.CPD1)
mean(abs.lat.CPD1)

abs.lat.CPL1 <- abs(res.lat.CPL1)
mean(abs.lat.CPL1)

abs.lat.PreDL1 <- abs(res.lat.PreDL1)
mean(abs.lat.PreDL1)

abs.lat.DbL1 <- abs(res.lat.DbL1)
mean(abs.lat.DbL1)

abs.lat.HL1 <- abs(res.lat.HL1)
mean(abs.lat.HL1)

abs.lat.HD1 <- abs(res.lat.HD1)
mean(abs.lat.HD1)

abs.lat.HW1 <- abs(res.lat.HW1)
mean(abs.lat.HW1)

abs.lat.SnL1 <- abs(res.lat.SnL1)
mean(abs.lat.SnL1)

abs.lat.OL1 <- abs(res.lat.OL1)
mean(abs.lat.OL1)


abs.form.D1 <- abs(res.form.D1)
mean(abs.form.D1)

abs.form.P11 <- abs(res.form.P11)
mean(abs.form.P11)

abs.form.P1.R1 <- abs(res.form.P1.R1)
mean(abs.form.P1.R1)

abs.form.LLSC1 <- abs(res.form.LLSC1)
mean(abs.form.LLSC1)

abs.form.SBLL1 <- abs(res.form.SBLL1)
mean(abs.form.SBLL1)

abs.form.BD1 <- abs(res.form.BD1)
mean(abs.form.BD1)

abs.form.CPD1 <- abs(res.form.CPD1)
mean(abs.form.CPD1)

abs.form.CPL1 <- abs(res.form.CPL1)
mean(abs.form.CPL1)

abs.form.PreDL1 <- abs(res.form.PreDL1)
mean(abs.form.PreDL1)

abs.form.DbL1 <- abs(res.form.DbL1)
mean(abs.form.DbL1)

abs.form.HL1 <- abs(res.form.HL1)
mean(abs.form.HL1)

abs.form.HD1 <- abs(res.form.HD1)
mean(abs.form.HD1)

abs.form.HW1 <- abs(res.form.HW1)
mean(abs.form.HW1)

abs.form.SnL1 <- abs(res.form.SnL1)
mean(abs.form.SnL1)

abs.form.OL1 <- abs(res.form.OL1)
mean(abs.form.OL1)



#let's get this into the raw1 data set so that we can plot this more easily

abs.res.D <- append(abs.lat.D1, abs.form.D1)
abs.res.P1 <- append(abs.lat.P11, abs.form.P11)
abs.res.P1.R <- append(abs.lat.P1.R1, abs.form.P1.R1)
abs.res.LLSC<- append(abs.lat.LLSC1, abs.form.LLSC1)
abs.res.SBLL<- append(abs.lat.SBLL1, abs.form.SBLL1)
abs.res.BD<- append(abs.lat.BD1, abs.form.BD1)
abs.res.CPD<- append(abs.lat.CPD1, abs.form.CPD1)
abs.res.CPL<- append(abs.lat.CPL1, abs.form.CPL1)
abs.res.PreDL <- append(abs.lat.PreDL1, abs.form.PreDL1)
abs.res.DbL <- append(abs.lat.DbL1, abs.form.DbL1)
abs.res.HL<- append(abs.lat.HL1, abs.form.HL1)
abs.res.HD<- append(abs.lat.HD1, abs.form.HD1)
abs.res.HW <- append(abs.lat.HW1, abs.form.HW1)
abs.res.SnL <- append(abs.lat.SnL1, abs.form.SnL1)
abs.res.OL <- append(abs.lat.OL1, abs.form.OL1)

raw4 <- cbind(raw2, abs.res.D, abs.res.P1, abs.res.P1.R, abs.res.LLSC, abs.res.SBLL, abs.res.BD, abs.res.CPD, abs.res.CPL, abs.res.PreDL, abs.res.DbL, abs.res.HL, abs.res.HD, abs.res.HW, abs.res.SnL, abs.res.OL)
#because I performed the regression calculations on the raw data, I believe it automatically removes NAs BUT only for that value. So a fish that is excluded from P1 may be included for LLSC. This means that the number of fish at the end in each of the abs. lists is different. It won't let me append it to the original data frame because the number of rows don't match. Will go back and use a dataset with NAs removed (boo) to see if that helps --> yep, that did it

#need to put the PCA visualization for residuals here since raw4 doesn't appear until now

PCA2 <- prcomp(raw4[, 33:48], center=TRUE, scale. = TRUE) #includes all 22 traits 
summary(PCA2)
loadings1 <- PCA2$rotation
loadings1[, 1:5]

plot10<- autoplot(PCA2, x=1, y=2, data = raw4, colour='SPP', loadings=TRUE, loadings.colour='navyblue', loadings.label=TRUE, loadings.label.colour='navyblue', loadings.label.size=5, loadings.label.vjust= 1, loadings.label.hjust= 1.2, frame=TRUE, frame.type='norm')+ ggtitle("PCA Plot of Morphology trait Residuals") + theme_minimal()
plot10

plot11<- autoplot(PCA2, x=1, y=2, data = raw4, colour='SPP', loadings=FALSE, loadings.label=FALSE, frame=TRUE, frame.type='norm')+ ggtitle("PCA Plot of Morphology traits") + theme_minimal()
plot11


```


##### Residual Comparisons {.tabset .tabset-fade .tabset-pills}



-   STEP FOUR: plot the mean of the |residuals| for both species, for all traits

```{r}

library(ggbeeswarm)
library(dplyr)


ggplot(raw4, aes(SPP, abs.res.D)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)


scatter_violin <- ggplot(data=raw4, aes(x=SPP, y=abs.res.D)) +
  geom_violin(trim = FALSE) + 
  stat_summary(
    fun.data = "mean_sdl",  fun.args = list(mult = 1),
    geom = "pointrange", color = "black"
    )

print(scatter_violin)

scatter_violin1 <- ggplot(data=raw4, aes(x=SPP, y=abs.res.D)) +
  geom_violin(trim = FALSE) + 
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="crossbar", fill="red", width=0.03)

print(scatter_violin1)



ggplot(raw4, aes(SPP, abs.res.P1)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw4, aes(SPP, abs.res.P1.R)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3) 

ggplot(raw4, aes(SPP, abs.res.LLSC)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw4, aes(SPP, abs.res.SBLL)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw4, aes(SPP, abs.res.BD)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw4, aes(SPP, abs.res.CPD)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw4, aes(SPP, abs.res.CPL)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3) 

ggplot(raw4, aes(SPP, abs.res.PreDL)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw4, aes(SPP, abs.res.DbL)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw4, aes(SPP, abs.res.HL)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw4, aes(SPP, abs.res.HD)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw4, aes(SPP, abs.res.HW)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw4, aes(SPP, abs.res.SnL)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw4, aes(SPP, abs.res.OL)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)




```



#### F tests to compare species {.tabset .tabset-fade .tabset-pills}

    -   will do two-tailed and check out the means to infer direction (see beginning for trait means w/o body correction)
    -   this will only be for the traits that did not have a significant regression compared to SL (so P2s, A, SALL, SBDF, and FLA) 

```{r, echo=FALSE}


var.left.pel <- var.test(lat$P2.L, form$P2.L, alternative = "two.sided")
var.left.pel

var.rig.pel <- var.test(lat$P2.R, form$P2.R, alternative = "two.sided")
var.rig.pel

var.anal <- var.test(lat$A, form$A, alternative = "two.sided")
var.anal

var.sca.ab.ll <- var.test(lat$SALL, form$SALL, alternative = "two.sided")
var.sca.ab.ll

var.sca.df <- var.test(lat$SBDF, form$SBDF, alternative = "two.sided")
var.sca.df

var.flu.asy <- var.test(lat$FLA, form$FLA, alternative = "two.sided")
var.flu.asy



```






<br><br><br><br>




#### T tests to compare species {.tabset .tabset-fade .tabset-pills}


   -    will do two-tailed and check out the means to infer direction (see beginning for trait means w/o body correction)
   -    this will be for the traits that *did* have a significant regression compared to SL; will be using the absolute value residuals. 
    


```{r, echo=FALSE}


ttest.abs.D1 <- t.test(abs.lat.D1, abs.form.D1, alternative = "two.sided")
ttest.abs.D1


ttest.abs.P11 <- t.test(abs.lat.P11, abs.form.P11, alternative = "two.sided")
ttest.abs.P11


ttest.abs.P1.R1 <- t.test(abs.lat.P1.R1, abs.form.P1.R1, alternative = "two.sided")
ttest.abs.P1.R1


ttest.abs.LLSC1 <- t.test(abs.lat.LLSC1, abs.form.LLSC1, alternative = "two.sided")
ttest.abs.LLSC1


ttest.abs.SBLL1 <- t.test(abs.lat.SBLL1, abs.form.SBLL1, alternative = "two.sided")
ttest.abs.SBLL1


ttest.abs.BD1 <- t.test(abs.lat.BD1, abs.form.BD1, alternative = "two.sided")
ttest.abs.BD1


ttest.abs.CPD1 <- t.test(abs.lat.CPD1, abs.form.CPD1, alternative = "two.sided")
ttest.abs.CPD1


ttest.abs.CPL1 <- t.test(abs.lat.CPL1, abs.form.CPL1, alternative = "two.sided")
ttest.abs.CPL1


ttest.abs.PreDL1 <- t.test(abs.lat.PreDL1, abs.form.PreDL1, alternative = "two.sided")
ttest.abs.PreDL1


ttest.abs.DbL1 <- t.test(abs.lat.DbL1, abs.form.DbL1, alternative = "two.sided")
ttest.abs.DbL1


ttest.abs.HL1 <- t.test(abs.lat.HL1, abs.form.HL1, alternative = "two.sided")
ttest.abs.HL1


ttest.abs.HD1 <- t.test(abs.lat.HD1, abs.form.HD1, alternative = "two.sided")
ttest.abs.HD1


ttest.abs.HW1 <- t.test(abs.lat.HW1, abs.form.HW1, alternative = "two.sided")
ttest.abs.HW1


ttest.abs.SnL1 <- t.test(abs.lat.SnL1, abs.form.SnL1, alternative = "two.sided")
ttest.abs.SnL1


ttest.abs.OL1 <- t.test(abs.lat.OL1, abs.form.OL1, alternative = "two.sided")
ttest.abs.OL1




```




#### Summary of variance results {.tabset .tabset-fade .tabset-pills}


```{r}

average.table <- matrix(c(ttest.abs.D1$p.value, mean(abs.lat.D1, na.rm = TRUE), mean(abs.form.D1, na.rm = TRUE), ttest.abs.P11$p.value, mean(abs.lat.P11, na.rm = TRUE), mean(abs.form.P11, na.rm = TRUE), var.rig.pel$p.value, mean(lat$P2.R, na.rm = TRUE), mean(form$P2.R, na.rm = TRUE), var.left.pel$p.value, mean(lat$P2.L, na.rm = TRUE), mean(form$P2.L, na.rm = TRUE), var.anal$p.value, mean(lat$A, na.rm = TRUE), mean(form$A, na.rm = TRUE), ttest.abs.P1.R1$p.value, mean(abs.lat.P1.R1, na.rm = TRUE), mean(abs.form.P1.R1, na.rm = TRUE), ttest.abs.LLSC1$p.value, mean(abs.lat.LLSC1, na.rm = TRUE), mean(abs.form.LLSC1, na.rm = TRUE), var.sca.ab.ll$p.value, mean(lat$SALL, na.rm = TRUE), mean(form$SALL, na.rm = TRUE), ttest.abs.SBLL1$p.value, mean(abs.lat.SBLL1, na.rm = TRUE), mean(abs.form.SBLL1, na.rm = TRUE), var.sca.df$p.value, mean(lat$SBDF, na.rm = TRUE), mean(form$SBDF, na.rm = TRUE), ttest.abs.BD1$p.value, mean(abs.lat.BD1, na.rm = TRUE), mean(abs.form.BD1, na.rm = TRUE), ttest.abs.CPD1$p.value, mean(abs.lat.CPD1, na.rm = TRUE), mean(abs.form.CPD1, na.rm = TRUE), ttest.abs.CPL1$p.value, mean(abs.lat.CPL1, na.rm = TRUE), mean(abs.form.CPL1, na.rm = TRUE), ttest.abs.PreDL1$p.value, mean(abs.lat.PreDL1, na.rm = TRUE), mean(abs.form.PreDL1, na.rm = TRUE), ttest.abs.DbL1$p.value, mean(abs.lat.DbL1, na.rm = TRUE), mean(abs.form.DbL1, na.rm = TRUE), ttest.abs.HL1$p.value, mean(abs.lat.HL1, na.rm = TRUE), mean(abs.form.HL1, na.rm = TRUE), ttest.abs.HD1$p.value, mean(abs.lat.HD1, na.rm = TRUE), mean(abs.form.HD1, na.rm = TRUE), ttest.abs.HW1$p.value, mean(abs.lat.HW1, na.rm = TRUE), mean(abs.form.HW1, na.rm = TRUE), ttest.abs.SnL1$p.value, mean(abs.lat.SnL1, na.rm = TRUE), mean(abs.form.SnL1, na.rm = TRUE), ttest.abs.OL1$p.value, mean(abs.lat.OL1, na.rm = TRUE), mean(abs.form.OL1, na.rm = TRUE), var.flu.asy$p.value, mean(lat$FLA, na.rm = TRUE), mean(form$FLA, na.rm = TRUE)), ncol=3, byrow=TRUE)

colnames(average.table)<- c('p-value for variance', 'lat mean', 'form mean')

rownames(average.table) <- c('dorsal rays', 'L pect rays', 'R pelvic rays*', 'L pelvic rays*', 'Anal rays', 'R pect rays*', 'lat line scales', 'scales above LL', 'scales below LL', 'scales before dor*', 'body dep', 'peduncle dep', 'peduncle leng', 'pre-dorsal', 'dorsal base', 'head lengtt', 'head depth', 'head width', 'snout leng', 'orbital leng', 'fluct. asymmetries')

average.table


```


***Visualizing the significant ones"***


```{r}

plot_multi_histogram <- function(df, feature, label_column) {
    plt <- ggplot(df, aes(x=eval(parse(text=feature)), fill=eval(parse(text=label_column)))) +
    geom_histogram(bins=10, alpha=0.4, position="identity", aes(y = ..density..), color="black") +
    geom_density(alpha=0.2)  +
    labs(x=feature, y = "Density")
    plt + guides(fill=guide_legend(title=label_column))
}

plot_multi_histogram(raw4, "abs.res.P1.R", "SPP")

plot_multi_histogram(raw4, "abs.res.SBLL", "SPP")

plot_multi_histogram(raw4, "abs.res.DbL", "SPP")

plot_multi_histogram(raw4, "abs.res.HL", "SPP")

plot_multi_histogram(raw4, "FLA", "SPP")



```




### ANOVA {.tabset .tabset-fade .tabset-pills}

Will run a nested ANOVA on the residuals (and raw data that isn't affected by body size?) with location as a nested effect to see if variation is partitioned more within populations or among populations. 


```{r}


#runs on the assumption that each subgroup has a normal distribution, check for normality among location?
#raw.q1 <- raw1[raw1$QUARTILE == "Q1",]
#raw.q2 <- raw1[raw1$QUARTILE == "Q2",]
#raw.q3 <- raw1[raw1$QUARTILE == "Q3",]
#raw.q4 <- raw1[raw1$QUARTILE == "Q4",]

#ks.test(raw.q1$CPL, "pnorm", mean=mean(raw.q1$CPL), sd=sd(raw.q1$CPL)) #NOT SIG (NORMAL)

#seems to give me a 'ties' error with NA as the p value. When looking up the error most people stated this test was useless, but that the alternatives were also useless, so idk what to do...


nest <- aov(raw4$abs.res.D ~ raw4$SPP / factor(raw4$QUARTILE))
summary(nest)

A.D <- aov(abs.res.D ~ SPP*QUARTILE, data=raw4)
summary(A.D)

A.P1 <- aov(abs.res.P1 ~ SPP*QUARTILE, data=raw4)
summary(A.P1)

A.P1.R <- aov(abs.res.P1.R ~ SPP*QUARTILE, data=raw4)
summary(A.P1.R)

A.LLSC <- aov(abs.res.LLSC ~ SPP*QUARTILE, data=raw4)
summary(A.LLSC)

A.SBLL <- aov(abs.res.SBLL ~ SPP*QUARTILE, data=raw4)
summary(A.SBLL)

A.BD <- aov(abs.res.BD ~ SPP*QUARTILE, data=raw4)
summary(A.BD)

A.CPD <- aov(abs.res.CPD ~ SPP*QUARTILE, data=raw4)
summary(A.CPD)

A.CPL <- aov(abs.res.CPL ~ SPP*QUARTILE, data=raw4)
summary(A.CPL)

A.PreDL <- aov(abs.res.PreDL ~ SPP*QUARTILE, data=raw4)
summary(A.PreDL)

A.DbL <- aov(abs.res.DbL ~ SPP*QUARTILE, data=raw4)
summary(A.DbL)

A.HL <- aov(abs.res.HL ~ SPP*QUARTILE, data=raw4)
summary(A.HL)

A.HD <- aov(abs.res.HD ~ SPP*QUARTILE, data=raw4)
summary(A.HD)

A.HW <- aov(abs.res.HW ~ SPP*QUARTILE, data=raw4)
summary(A.HW)

A.SnL <- aov(abs.res.SnL ~ SPP*QUARTILE, data=raw4)
summary(A.SnL)

A.OL <- aov(abs.res.OL ~ SPP*QUARTILE, data=raw4)
summary(A.OL)

A.A <- aov(A ~ SPP*QUARTILE, data=raw4)
summary(A.A)

A.SALL <- aov(SALL ~ SPP*QUARTILE, data=raw4)
summary(A.SALL)

A.SBDF <- aov(SBDF ~ SPP*QUARTILE, data=raw4)
summary(A.SBDF)

A.FLA <- aov(FLA ~ SPP*QUARTILE, data=raw4)
summary(A.FLA)

ggplot(raw4, aes(x=factor(QUARTILE), y=FLA, fill=SPP)) + geom_boxplot()


library(ggplot2)


ggplot(raw4, aes(x=factor(QUARTILE), y=abs.res.D, fill=SPP)) +
  geom_boxplot()

nest2 <- aov(raw4$abs.res.P1.R ~ raw4$SPP / factor(raw4$QUARTILE))
summary(nest2)


ggplot(raw4, aes(x=factor(QUARTILE), y=abs.res.P1.R, fill=SPP)) +
  geom_boxplot()

```











<br><br><br><br>