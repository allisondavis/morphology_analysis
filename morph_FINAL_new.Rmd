---
title: "morph_FINAL_new"
author: "Allison Davis Connelly"
date: "12/22/2023"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# *Morphological variation of amazon and sailfin mollies* {.tabset .tabset-fade .tabset-pills}

In this study, I am looking at various populations of amazon and sailfin mollies across their native/introduced range to assess morphological variation both within and among the species. I am using the Pickle fish collections for my samples.

*Data collection* 

```{r, echo=FALSE}
library(curl)

raw <- curl("https://raw.githubusercontent.com/allisondavis/morphology_analysis/master/adavis_morphology_raw-data_NEAR-FINAL.csv")

raw <- read.csv(raw, header = TRUE, sep = ",", stringsAsFactors = TRUE)

#raw$SALL <- as.numeric(as.character(raw$SALL))




lat <- raw[raw$SPP == "p.latipinna",]


form <- raw[raw$SPP == "p.formosa",]


mex <- raw[raw$SPP == "p.mexicana",]


```


## Correcting for body size (residuals) {.tabset .tabset-fade .tabset-pills}

Since amazons are in general bigger than sailfin, we don't want any results to be due to this difference in body size bias. Therefore, we will see what traits are influenced by body size (regressions) and correct for body size when necessary (absolute value of residuals). We can then use the residuals when comparing between species for traits that are influenced by body size, and raw data for traits that are not influenced by body size. I will also calculate standardized residuals to compare residuals across traits in later analyses.

**Quick results summary:** traits *not* influenced by body size are left & right pelvic, anal, scales below lateral line and fluctuating asymmetry; all other traits influenced by body size. 


### Regressions {.tabset .tabset-fade .tabset-pills}

-   STEP ONE: plot trait vs body size

```{r}

library(ggplot2)
library(ggpubr)

lat1 <- lat[complete.cases(lat[, 15:37]),]
form1 <- form[complete.cases(form[, 15:37]),]
mex1 <- mex[complete.cases(mex[, 15:37]),]

##### LAT #####
reg.lat.D <- lm(lat1$D ~ lat1$SL)
sd.lat.D <- rstandard(reg.lat.D)
reg.lat.D.plot <- ggplot(lat1, aes(x = SL, y = D)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.D.plot

reg.lat.P1 <- lm(lat1$P1 ~ lat1$SL)
sd.lat.P1 <- rstandard(reg.lat.P1)
reg.lat.P1.plot <- ggplot(lat1, aes(x = SL, y = P1)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.P1.plot

reg.lat.P2.L <- lm(lat1$P2.L ~ lat1$SL)
sd.lat.P2.L <- rstandard(reg.lat.P2.L)
reg.lat.P2.L.plot <- ggplot(lat1, aes(x = SL, y = P2.L)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.P2.L.plot

reg.lat.P2.R <- lm(lat1$P2.R ~ lat1$SL)
sd.lat.P2.R <- rstandard(reg.lat.P2.R)
reg.lat.P2.R.plot <- ggplot(lat1, aes(x = SL, y = P2.R)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.P2.R.plot

reg.lat.A <- lm(lat1$A ~ lat1$SL)
sd.lat.A <- rstandard(reg.lat.A)
reg.lat.A.plot <- ggplot(lat1, aes(x = SL, y = A)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.A.plot

reg.lat.P1.R <- lm(lat1$P1.R ~ lat1$SL)
sd.lat.P1.R <- rstandard(reg.lat.P1.R)
reg.lat.P1.R.plot <- ggplot(lat1, aes(x = SL, y = P1.R)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.P1.R.plot

reg.lat.LLSC <- lm(lat1$LLSC ~ lat1$SL)
sd.lat.LLSC <- rstandard(reg.lat.LLSC)
reg.lat.LLSC.plot <- ggplot(lat1, aes(x = SL, y = LLSC)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.LLSC.plot

reg.lat.SALL <- lm(lat1$SALL ~ lat1$SL)
sd.lat.SALL <- rstandard(reg.lat.SALL)
reg.lat.SALL.plot <- ggplot(lat1, aes(x = SL, y = SALL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.SALL.plot

reg.lat.SBLL <- lm(lat1$SBLL ~ lat1$SL)
sd.lat.SBLL <- rstandard(reg.lat.SBLL)
reg.lat.SBLL.plot <- ggplot(lat1, aes(x = SL, y = SBLL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.SBLL.plot

reg.lat.SBDF <- lm(lat1$SBDF ~ lat1$SL)
sd.lat.SBDF <- rstandard(reg.lat.SBDF)
reg.lat.SBDF.plot <- ggplot(lat1, aes(x = SL, y = SBDF)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.SBDF.plot

reg.lat.BD <- lm(lat1$BD ~ lat1$SL)
sd.lat.BD <- rstandard(reg.lat.BD)
reg.lat.BD.plot <- ggplot(lat1, aes(x = SL, y = BD)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.BD.plot

reg.lat.CPD <- lm(lat1$CPD ~ lat1$SL)
sd.lat.CPD <- rstandard(reg.lat.CPD)
reg.lat.CPD.plot <- ggplot(lat1, aes(x = SL, y = CPD)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.CPD.plot

reg.lat.CPL <- lm(lat1$CPL ~ lat1$SL)
sd.lat.CPL <- rstandard(reg.lat.CPL)
reg.lat.CPL.plot <- ggplot(lat1, aes(x = SL, y = CPL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.CPL.plot

reg.lat.PreDL <- lm(lat1$PreDL ~ lat1$SL)
sd.lat.PreDL <- rstandard(reg.lat.PreDL)
reg.lat.PreDL.plot <- ggplot(lat1, aes(x = SL, y = PreDL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.PreDL.plot

reg.lat.DbL <- lm(lat1$DbL ~ lat1$SL)
sd.lat.DbL <- rstandard(reg.lat.DbL)
reg.lat.DbL.plot <- ggplot(lat1, aes(x = SL, y = DbL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.DbL.plot

reg.lat.HL <- lm(lat1$HL ~ lat1$SL)
sd.lat.HL <- rstandard(reg.lat.HL)
reg.lat.HL.plot <- ggplot(lat1, aes(x = SL, y = HL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.HL.plot

reg.lat.HD <- lm(lat1$HD ~ lat1$SL)
sd.lat.HD <- rstandard(reg.lat.HD)
reg.lat.HD.plot <- ggplot(lat1, aes(x = SL, y = HD)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.HD.plot

reg.lat.HW <- lm(lat1$HW ~ lat1$SL)
sd.lat.HW <- rstandard(reg.lat.HW)
reg.lat.HW.plot <- ggplot(lat1, aes(x = SL, y = HW)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.HW.plot

reg.lat.SnL <- lm(lat1$SnL ~ lat1$SL)
sd.lat.SnL <- rstandard(reg.lat.SnL)
reg.lat.SnL.plot <- ggplot(lat1, aes(x = SL, y = SnL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.SnL.plot

reg.lat.OL <- lm(lat1$OL ~ lat1$SL)
sd.lat.OL <- rstandard(reg.lat.OL)
reg.lat.OL.plot <- ggplot(lat1, aes(x = SL, y = OL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.OL.plot

reg.lat.FLA <- lm(lat1$FLA ~ lat1$SL)
sd.lat.FLA <- rstandard(reg.lat.FLA)
reg.lat.FLA.plot <- ggplot(lat1, aes(x = SL, y = FLA)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.lat.FLA.plot

##### FORM #####

reg.form.D <- lm(form1$D ~ form1$SL)
sd.form.D <- rstandard(reg.form.D)
reg.form.D.plot <- ggplot(form1, aes(x =SL, y = D)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.D.plot

reg.form.P1 <- lm(form1$P1 ~ form1$SL)
sd.form.P1 <- rstandard(reg.form.P1)
reg.form.P1.plot <- ggplot(form1, aes(x = SL, y = P1)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.P1.plot

reg.form.P2.L <- lm(form1$P2.L ~ form1$SL)
sd.form.P2.L <- rstandard(reg.form.P2.L)
reg.form.P2.L.plot <- ggplot(form1, aes(x = SL, y = P2.L)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.P2.L.plot

reg.form.P2.R <- lm(form1$P2.R ~ form1$SL)
sd.form.P2.R <- rstandard(reg.form.P2.R)
reg.form.P2.R.plot <- ggplot(form1, aes(x = SL, y = P2.R)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.P2.R.plot

reg.form.A <- lm(form1$A ~ form1$SL)
sd.form.A <- rstandard(reg.form.A)
reg.form.A.plot <- ggplot(form1, aes(x = SL, y = A)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.A.plot

reg.form.P1.R <- lm(form1$P1.R ~ form1$SL)
sd.form.P1.R <- rstandard(reg.form.P1.R)
reg.form.P1.R.plot <- ggplot(form1, aes(x = SL, y = P1.R)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.P1.R.plot

reg.form.LLSC <- lm(form1$LLSC ~ form1$SL)
sd.form.LLSC <- rstandard(reg.form.LLSC)
reg.form.LLSC.plot <- ggplot(form1, aes(x = SL, y = LLSC)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.LLSC.plot

reg.form.SALL <- lm(form1$SALL ~ form1$SL)
sd.form.SALL <- rstandard(reg.form.SALL)
reg.form.SALL.plot <- ggplot(form1, aes(x = SL, y = SALL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.SALL.plot

reg.form.SBLL <- lm(form1$SBLL ~ form1$SL)
sd.form.SBLL <- rstandard(reg.form.SBLL)
reg.form.SBLL.plot <- ggplot(form1, aes(x = SL, y = SBLL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.SBLL.plot

reg.form.SBDF <- lm(form1$SBDF ~ form1$SL)
sd.form.SBDF <- rstandard(reg.form.SBDF)
reg.form.SBDF.plot <- ggplot(form1, aes(x = SL, y = SBDF)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.SBDF.plot

reg.form.BD <- lm(form1$BD ~ form1$SL)
sd.form.BD <- rstandard(reg.form.BD)
reg.form.BD.plot <- ggplot(form1, aes(x = SL, y = BD)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.BD.plot

reg.form.CPD <- lm(form1$CPD ~ form1$SL)
sd.form.CPD <- rstandard(reg.form.CPD)
reg.form.CPD.plot <- ggplot(form1, aes(x = SL, y = CPD)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.CPD.plot

reg.form.CPL <- lm(form1$CPL ~ form1$SL)
sd.form.CPL <- rstandard(reg.form.CPL)
reg.form.CPL.plot <- ggplot(form1, aes(x = SL, y = CPL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.CPL.plot

reg.form.PreDL <- lm(form1$PreDL ~ form1$SL)
sd.form.PreDL <- rstandard(reg.form.PreDL)
reg.form.PreDL.plot <- ggplot(form1, aes(x = SL, y = PreDL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.PreDL.plot

reg.form.DbL <- lm(form1$DbL ~ form1$SL)
sd.form.DbL <- rstandard(reg.form.DbL)
reg.form.DbL.plot <- ggplot(form1, aes(x = SL, y = DbL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.DbL.plot

reg.form.HL <- lm(form1$HL ~ form1$SL)
sd.form.HL <- rstandard(reg.form.HL)
reg.form.HL.plot <- ggplot(form1, aes(x = SL, y = HL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.HL.plot

reg.form.HD <- lm(form1$HD ~ form1$SL)
sd.form.HD <- rstandard(reg.form.HD)
reg.form.HD.plot <- ggplot(form1, aes(x = SL, y = HD)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.HD.plot

reg.form.HW <- lm(form1$HW ~ form1$SL)
sd.form.HW <- rstandard(reg.form.HW)
reg.form.HW.plot <- ggplot(form1, aes(x = SL, y = HW)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.HW.plot

reg.form.SnL <- lm(form1$SnL ~ form1$SL)
sd.form.SnL <- rstandard(reg.form.SnL)
reg.form.SnL.plot <- ggplot(form1, aes(x = SL, y = SnL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.SnL.plot

reg.form.OL <- lm(form1$OL ~ form1$SL)
sd.form.OL <- rstandard(reg.form.OL)
reg.form.OL.plot <- ggplot(form1, aes(x = SL, y = OL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.OL.plot

reg.form.FLA <- lm(form1$FLA ~ form1$SL)
sd.form.FLA <- rstandard(reg.form.FLA)
reg.form.FLA.plot <- ggplot(form1, aes(x = SL, y = FLA)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.form.FLA.plot



##### MEX #####
reg.mex.D <- lm(mex1$D ~ mex1$SL)
sd.mex.D <- rstandard(reg.mex.D)
reg.mex.D.plot <- ggplot(mex1, aes(x = SL, y = D)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.mex.D.plot

reg.mex.P1 <- lm(mex1$P1 ~ mex1$SL)
sd.mex.P1 <- rstandard(reg.mex.P1)
reg.mex.P1.plot <- ggplot(mex1, aes(x = SL, y = P1)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.mex.P1.plot

reg.mex.P2.L <- lm(mex1$P2.L ~ mex1$SL)
sd.mex.P2.L <- rstandard(reg.mex.P2.L)
reg.mex.P2.L.plot <- ggplot(mex1, aes(x = SL, y = P2.L)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.mex.P2.L.plot

reg.mex.P2.R <- lm(mex1$P2.R ~ mex1$SL)
sd.mex.P2.R <- rstandard(reg.mex.P2.R)
reg.mex.P2.R.plot <- ggplot(mex1, aes(x = SL, y = P2.R)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.mex.P2.R.plot

reg.mex.A <- lm(mex1$A ~ mex1$SL)
sd.mex.A <- rstandard(reg.mex.A)
reg.mex.A.plot <- ggplot(mex1, aes(x = SL, y = A)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.mex.A.plot

reg.mex.P1.R <- lm(mex1$P1.R ~ mex1$SL)
sd.mex.P1.R <- rstandard(reg.mex.P1.R)
reg.mex.P1.R.plot <- ggplot(mex1, aes(x = SL, y = P1.R)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.mex.P1.R.plot

reg.mex.LLSC <- lm(mex1$LLSC ~ mex1$SL)
sd.mex.LLSC <- rstandard(reg.mex.LLSC)
reg.mex.LLSC.plot <- ggplot(mex1, aes(x = SL, y = LLSC)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.mex.LLSC.plot

reg.mex.SALL <- lm(mex1$SALL ~ mex1$SL)
sd.mex.SALL <- rstandard(reg.mex.SALL)
reg.mex.SALL.plot <- ggplot(mex1, aes(x = SL, y = SALL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.mex.SALL.plot

reg.mex.SBLL <- lm(mex1$SBLL ~ mex1$SL)
sd.mex.SBLL <- rstandard(reg.mex.SBLL)
reg.mex.SBLL.plot <- ggplot(mex1, aes(x = SL, y = SBLL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.mex.SBLL.plot

reg.mex.SBDF <- lm(mex1$SBDF ~ mex1$SL)
sd.mex.SBDF <- rstandard(reg.mex.SBDF)
reg.mex.SBDF.plot <- ggplot(mex1, aes(x = SL, y = SBDF)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.mex.SBDF.plot

reg.mex.BD <- lm(mex1$BD ~ mex1$SL)
sd.mex.BD <- rstandard(reg.mex.BD)
reg.mex.BD.plot <- ggplot(mex1, aes(x = SL, y = BD)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.mex.BD.plot

reg.mex.CPD <- lm(mex1$CPD ~ mex1$SL)
sd.mex.CPD <- rstandard(reg.mex.CPD)
reg.mex.CPD.plot <- ggplot(mex1, aes(x = SL, y = CPD)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.mex.CPD.plot

reg.mex.CPL <- lm(mex1$CPL ~ mex1$SL)
sd.mex.CPL <- rstandard(reg.mex.CPL)
reg.mex.CPL.plot <- ggplot(mex1, aes(x = SL, y = CPL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.mex.CPL.plot

reg.mex.PreDL <- lm(mex1$PreDL ~ mex1$SL)
sd.mex.PreDL <- rstandard(reg.mex.PreDL)
reg.mex.PreDL.plot <- ggplot(mex1, aes(x = SL, y = PreDL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.mex.PreDL.plot

reg.mex.DbL <- lm(mex1$DbL ~ mex1$SL)
sd.mex.DbL <- rstandard(reg.mex.DbL)
reg.mex.DbL.plot <- ggplot(mex1, aes(x = SL, y = DbL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.mex.DbL.plot

reg.mex.HL <- lm(mex1$HL ~ mex1$SL)
sd.mex.HL <- rstandard(reg.mex.HL)
reg.mex.HL.plot <- ggplot(mex1, aes(x = SL, y = HL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.mex.HL.plot

reg.mex.HD <- lm(mex1$HD ~ mex1$SL)
sd.mex.HD <- rstandard(reg.mex.HD)
reg.mex.HD.plot <- ggplot(mex1, aes(x = SL, y = HD)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.mex.HD.plot

reg.mex.HW <- lm(mex1$HW ~ mex1$SL)
sd.mex.HW <- rstandard(reg.mex.HW)
reg.mex.HW.plot <- ggplot(mex1, aes(x = SL, y = HW)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.mex.HW.plot

reg.mex.SnL <- lm(mex1$SnL ~ mex1$SL)
sd.mex.SnL <- rstandard(reg.mex.SnL)
reg.mex.SnL.plot <- ggplot(mex1, aes(x = SL, y = SnL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.mex.SnL.plot

reg.mex.OL <- lm(mex1$OL ~ mex1$SL)
sd.mex.OL <- rstandard(reg.mex.OL)
reg.mex.OL.plot <- ggplot(mex1, aes(x = SL, y = OL)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.mex.OL.plot

reg.mex.FLA <- lm(mex1$FLA ~ mex1$SL)
sd.mex.FLA <- rstandard(reg.mex.FLA)
reg.mex.FLA.plot <- ggplot(mex1, aes(x = SL, y = FLA)) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  stat_cor(label.y = 10)
reg.mex.FLA.plot


```



### Residuals {.tabset .tabset-fade .tabset-pills}

-   STEP TWO: get residuals for each individual for traits that were influenced by body size

```{r echo=FALSE}

##### LAT #####
res.lat.D <- resid(reg.lat.D)

res.lat.P1 <- resid(reg.lat.P1)

res.lat.P1.R <- resid(reg.lat.P1.R)

res.lat.LLSC <- resid(reg.lat.LLSC)

res.lat.SALL <- resid(reg.lat.SALL)

res.lat.SBLL <- resid(reg.lat.SBLL)

res.lat.BD <- resid(reg.lat.BD)

res.lat.CPD <- resid(reg.lat.CPD)

res.lat.CPL <- resid(reg.lat.CPL)

res.lat.PreDL <- resid(reg.lat.PreDL)

res.lat.DbL <- resid(reg.lat.DbL)

res.lat.HL <- resid(reg.lat.HL)

res.lat.HD <- resid(reg.lat.HD)

res.lat.HW <- resid(reg.lat.HW)

res.lat.SnL <- resid(reg.lat.SnL)

res.lat.OL <- resid(reg.lat.OL)

##### FORM #####

res.form.D <- resid(reg.form.D)

res.form.P1 <- resid(reg.form.P1)

res.form.P1.R <- resid(reg.form.P1.R)

res.form.LLSC <- resid(reg.form.LLSC)

res.form.SALL <- resid(reg.form.SALL)

res.form.SBLL <- resid(reg.form.SBLL)

res.form.BD <- resid(reg.form.BD)

res.form.CPD <- resid(reg.form.CPD)

res.form.CPL <- resid(reg.form.CPL)

res.form.PreDL <- resid(reg.form.PreDL)

res.form.DbL <- resid(reg.form.DbL)

res.form.HL <- resid(reg.form.HL)

res.form.HD <- resid(reg.form.HD)

res.form.HW <- resid(reg.form.HW)

res.form.SnL <- resid(reg.form.SnL)

res.form.OL <- resid(reg.form.OL)


##### MEX #####
res.mex.D <- resid(reg.mex.D)

res.mex.P1 <- resid(reg.mex.P1)

res.mex.P1.R <- resid(reg.mex.P1.R)

res.mex.LLSC <- resid(reg.mex.LLSC)

res.mex.SALL <- resid(reg.mex.SALL)

res.mex.SBLL <- resid(reg.mex.SBLL)

res.mex.BD <- resid(reg.mex.BD)

res.mex.CPD <- resid(reg.mex.CPD)

res.mex.CPL <- resid(reg.mex.CPL)

res.mex.PreDL <- resid(reg.mex.PreDL)

res.mex.DbL <- resid(reg.mex.DbL)

res.mex.HL <- resid(reg.mex.HL)

res.mex.HD <- resid(reg.mex.HD)

res.mex.HW <- resid(reg.mex.HW)

res.mex.SnL <- resid(reg.mex.SnL)

res.mex.OL <- resid(reg.mex.OL)


```

-   STEP THREE: convert residuals to absolute value

```{r}

##### LAT #####

abs.lat.D <- abs(res.lat.D)
mean(abs.lat.D)

abs.lat.P1 <- abs(res.lat.P1)
mean(abs.lat.P1)

abs.lat.P1.R <- abs(res.lat.P1.R)
mean(abs.lat.P1.R)

abs.lat.LLSC <- abs(res.lat.LLSC)
mean(abs.lat.LLSC)

abs.lat.SALL <- abs(res.lat.SALL)
mean(abs.lat.SALL)

abs.lat.SBLL <- abs(res.lat.SBLL)
mean(abs.lat.SBLL)

abs.lat.BD <- abs(res.lat.BD)
mean(abs.lat.BD)

abs.lat.CPD <- abs(res.lat.CPD)
mean(abs.lat.CPD)

abs.lat.CPL <- abs(res.lat.CPL)
mean(abs.lat.CPL)

abs.lat.PreDL <- abs(res.lat.PreDL)
mean(abs.lat.PreDL)

abs.lat.DbL <- abs(res.lat.DbL)
mean(abs.lat.DbL)

abs.lat.HL <- abs(res.lat.HL)
mean(abs.lat.HL)

abs.lat.HD <- abs(res.lat.HD)
mean(abs.lat.HD)

abs.lat.HW <- abs(res.lat.HW)
mean(abs.lat.HW)

abs.lat.SnL <- abs(res.lat.SnL)
mean(abs.lat.SnL)

abs.lat.OL <- abs(res.lat.OL)
mean(abs.lat.OL)


##### FORM #####

abs.form.D <- abs(res.form.D)
mean(abs.form.D)

abs.form.P1 <- abs(res.form.P1)
mean(abs.form.P1)

abs.form.P1.R <- abs(res.form.P1.R)
mean(abs.form.P1.R)

abs.form.LLSC <- abs(res.form.LLSC)
mean(abs.form.LLSC)

abs.form.SALL <- abs(res.form.SALL)
mean(abs.form.SALL)

abs.form.SBLL <- abs(res.form.SBLL)
mean(abs.form.SBLL)

abs.form.BD <- abs(res.form.BD)
mean(abs.form.BD)

abs.form.CPD <- abs(res.form.CPD)
mean(abs.form.CPD)

abs.form.CPL <- abs(res.form.CPL)
mean(abs.form.CPL)

abs.form.PreDL <- abs(res.form.PreDL)
mean(abs.form.PreDL)

abs.form.DbL <- abs(res.form.DbL)
mean(abs.form.DbL)

abs.form.HL <- abs(res.form.HL)
mean(abs.form.HL)

abs.form.HD <- abs(res.form.HD)
mean(abs.form.HD)

abs.form.HW <- abs(res.form.HW)
mean(abs.form.HW)

abs.form.SnL <- abs(res.form.SnL)
mean(abs.form.SnL)

abs.form.OL <- abs(res.form.OL)
mean(abs.form.OL)

##### MEX #####

abs.mex.D <- abs(res.mex.D)
mean(abs.mex.D)

abs.mex.P1 <- abs(res.mex.P1)
mean(abs.mex.P1)

abs.mex.P1.R <- abs(res.mex.P1.R)
mean(abs.mex.P1.R)

abs.mex.LLSC <- abs(res.mex.LLSC)
mean(abs.mex.LLSC)

abs.mex.SALL <- abs(res.mex.SALL)
mean(abs.mex.SALL)

abs.mex.SBLL <- abs(res.mex.SBLL)
mean(abs.mex.SBLL)

abs.mex.BD <- abs(res.mex.BD)
mean(abs.mex.BD)

abs.mex.CPD <- abs(res.mex.CPD)
mean(abs.mex.CPD)

abs.mex.CPL <- abs(res.mex.CPL)
mean(abs.mex.CPL)

abs.mex.PreDL <- abs(res.mex.PreDL)
mean(abs.mex.PreDL)

abs.mex.DbL <- abs(res.mex.DbL)
mean(abs.mex.DbL)

abs.mex.HL <- abs(res.mex.HL)
mean(abs.mex.HL)

abs.mex.HD <- abs(res.mex.HD)
mean(abs.mex.HD)

abs.mex.HW <- abs(res.mex.HW)
mean(abs.mex.HW)

abs.mex.SnL <- abs(res.mex.SnL)
mean(abs.mex.SnL)

abs.mex.OL <- abs(res.mex.OL)
mean(abs.mex.OL)


#let's get this into the raw1 data set so that we can plot this more easily

abs.res.D <- c(abs.lat.D, abs.form.D, abs.mex.D)
abs.res.P1 <- c(abs.lat.P1, abs.form.P1, abs.mex.P1)
abs.res.P1.R <- c(abs.lat.P1.R, abs.form.P1.R, abs.mex.P1.R)
abs.res.LLSC<- c(abs.lat.LLSC, abs.form.LLSC, abs.mex.LLSC)
abs.res.SALL<- c(abs.lat.SALL, abs.form.SALL, abs.mex.SALL)
abs.res.SBLL<- c(abs.lat.SBLL, abs.form.SBLL, abs.mex.SBLL)
abs.res.BD<- c(abs.lat.BD, abs.form.BD, abs.mex.BD)
abs.res.CPD<- c(abs.lat.CPD, abs.form.CPD, abs.mex.CPD)
abs.res.CPL<- c(abs.lat.CPL, abs.form.CPL, abs.mex.CPL)
abs.res.PreDL <- c(abs.lat.PreDL, abs.form.PreDL, abs.mex.PreDL)
abs.res.DbL <- c(abs.lat.DbL, abs.form.DbL, abs.mex.DbL)
abs.res.HL<- c(abs.lat.HL, abs.form.HL, abs.mex.HL)
abs.res.HD<- c(abs.lat.HD, abs.form.HD, abs.mex.HD)
abs.res.HW <- c(abs.lat.HW, abs.form.HW, abs.mex.HW)
abs.res.SnL <- c(abs.lat.SnL, abs.form.SnL, abs.mex.SnL)
abs.res.OL <- c(abs.lat.OL, abs.form.OL, abs.mex.OL)

raw1 <- raw[complete.cases(raw[, 15:37]),] #since the regressions automatically pulled the NAs out, the appended data set does not match the original data set. Will remove NAs in original data set to match. 

raw2 <- cbind(raw1, abs.res.D, abs.res.P1, abs.res.P1.R, abs.res.LLSC, abs.res.SALL, abs.res.BD, abs.res.CPD, abs.res.CPL, abs.res.PreDL, abs.res.DbL, abs.res.HL, abs.res.HD, abs.res.HW, abs.res.SnL, abs.res.OL)

```

### Residual Comparisons {.tabset .tabset-fade .tabset-pills}



-   STEP FOUR: plot the mean of the |residuals| for both species, for all traits influenced by body size

```{r}

library(ggbeeswarm)
library(dplyr)


ggplot(raw2, aes(SPP, abs.res.D)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)


scatter_violin <- ggplot(data=raw2, aes(x=SPP, y=abs.res.D)) +
  geom_violin(trim = FALSE) + 
  stat_summary(
    fun.data = "mean_sdl",  fun.args = list(mult = 1),
    geom = "pointrange", color = "black"
    )

print(scatter_violin)

scatter_violin1 <- ggplot(data=raw2, aes(x=SPP, y=abs.res.D)) +
  geom_violin(trim = FALSE) + 
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="crossbar", fill="red", width=0.03)

print(scatter_violin1)



ggplot(raw2, aes(SPP, abs.res.P1)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw2, aes(SPP, abs.res.P1.R)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3) 

ggplot(raw2, aes(SPP, abs.res.LLSC)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw2, aes(SPP, abs.res.SBLL)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw2, aes(SPP, abs.res.BD)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw2, aes(SPP, abs.res.CPD)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw2, aes(SPP, abs.res.CPL)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3) 

ggplot(raw2, aes(SPP, abs.res.PreDL)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw2, aes(SPP, abs.res.DbL)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw2, aes(SPP, abs.res.HL)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw2, aes(SPP, abs.res.HD)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw2, aes(SPP, abs.res.HW)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw2, aes(SPP, abs.res.SnL)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)

ggplot(raw2, aes(SPP, abs.res.OL)) +
  geom_point(alpha=0.3) +
  stat_summary(fun.data=function(x){mean_cl_normal(x, conf.int=.683)}, geom="errorbar", 
               width=0.03, colour="red", alpha=0.7) +
  stat_summary(fun=mean, geom="point", fill="red", pch=21, size=3)




```




## Comparing variation (F & T-tests) {.tabset .tabset-fade .tabset-pills}

F tests on residuals doesn't make much sense; the residuals themselves are representative of the variation present, as they are the distance from the mean. Therefore, F tests on residuals is like variance of the variance. Instead, I have to do a t-test on the absolute value of the residuals. In this sense, we want to see if the mean of the absolute residuals is higher or lower for asexual species--is the average amount of variation higher or lower for this trait? Based on the regressions, if the trait was influenced by body size, I will perform a t-test on the absolute value of the residuals. If the trait was not influenced by body size, I will perform an F test of variance on the raw data.

**Quick results summary:** 


    -   will do two-tailed and check out the residual means to infer direction; for traits in which we use raw data, a one-tailed f-test will be perfomed in both direction to determine which species is varying more. We will also visulize the variation using a histogram to confirm direction results.

### F tests of variation {.tabset .tabset-fade .tabset-pills} 

This is for traits NOT influenced by body size. 

```{r, echo=FALSE}


var.left.pel <- var.test(lat$P2.L, form$P2.L, alternative = "two.sided")
var.left.pel

var.rig.pel <- var.test(lat$P2.R, form$P2.R, alternative = "two.sided")
var.rig.pel

var.anal <- var.test(lat$A, form$A, alternative = "two.sided")
var.anal

var.sca.ab.ll <- var.test(lat$SALL, form$SALL, alternative = "two.sided")
var.sca.ab.ll

var.sca.df <- var.test(lat$SBDF, form$SBDF, alternative = "two.sided")
var.sca.df

var.flu.asy <- var.test(lat$FLA, form$FLA, alternative = "two.sided")
var.flu.asy



```






<br><br><br><br>




### T tests on residuals {.tabset .tabset-fade .tabset-pills}

This will be for traits that WERE influenced by body size. The absolute value of the residuals will be used. 

```{r, echo=FALSE}


ttest.abs.D <- t.test(abs.lat.D, abs.form.D, alternative = "two.sided")
ttest.abs.D


ttest.abs.P1 <- t.test(abs.lat.P1, abs.form.P1, alternative = "two.sided")
ttest.abs.P1


ttest.abs.P1.R <- t.test(abs.lat.P1.R, abs.form.P1.R, alternative = "two.sided")
ttest.abs.P1.R


ttest.abs.LLSC <- t.test(abs.lat.LLSC, abs.form.LLSC, alternative = "two.sided")
ttest.abs.LLSC


ttest.abs.SBLL <- t.test(abs.lat.SBLL, abs.form.SBLL, alternative = "two.sided")
ttest.abs.SBLL


ttest.abs.BD <- t.test(abs.lat.BD, abs.form.BD, alternative = "two.sided")
ttest.abs.BD


ttest.abs.CPD <- t.test(abs.lat.CPD, abs.form.CPD, alternative = "two.sided")
ttest.abs.CPD


ttest.abs.CPL <- t.test(abs.lat.CPL, abs.form.CPL, alternative = "two.sided")
ttest.abs.CPL


ttest.abs.PreDL <- t.test(abs.lat.PreDL, abs.form.PreDL, alternative = "two.sided")
ttest.abs.PreDL


ttest.abs.DbL <- t.test(abs.lat.DbL, abs.form.DbL, alternative = "two.sided")
ttest.abs.DbL


ttest.abs.HL <- t.test(abs.lat.HL, abs.form.HL, alternative = "two.sided")
ttest.abs.HL


ttest.abs.HD <- t.test(abs.lat.HD, abs.form.HD, alternative = "two.sided")
ttest.abs.HD


ttest.abs.HW <- t.test(abs.lat.HW, abs.form.HW, alternative = "two.sided")
ttest.abs.HW


ttest.abs.SnL <- t.test(abs.lat.SnL, abs.form.SnL, alternative = "two.sided")
ttest.abs.SnL


ttest.abs.OL <- t.test(abs.lat.OL, abs.form.OL, alternative = "two.sided")
ttest.abs.OL




```




### Summary of variance results {.tabset .tabset-fade .tabset-pills}


```{r}

average.table <- matrix(c(ttest.abs.D$p.value, mean(abs.lat.D, na.rm = TRUE), mean(abs.form.D, na.rm = TRUE), ttest.abs.P1$p.value, mean(abs.lat.P1, na.rm = TRUE), mean(abs.form.P1, na.rm = TRUE), var.rig.pel$p.value, mean(lat$P2.R, na.rm = TRUE), mean(form$P2.R, na.rm = TRUE), var.left.pel$p.value, mean(lat$P2.L, na.rm = TRUE), mean(form$P2.L, na.rm = TRUE), var.anal$p.value, mean(lat$A, na.rm = TRUE), mean(form$A, na.rm = TRUE), ttest.abs.P1.R$p.value, mean(abs.lat.P1.R, na.rm = TRUE), mean(abs.form.P1.R, na.rm = TRUE), ttest.abs.LLSC$p.value, mean(abs.lat.LLSC, na.rm = TRUE), mean(abs.form.LLSC, na.rm = TRUE), var.sca.ab.ll$p.value, mean(lat$SALL, na.rm = TRUE), mean(form$SALL, na.rm = TRUE), ttest.abs.SBLL$p.value, mean(abs.lat.SBLL, na.rm = TRUE), mean(abs.form.SBLL, na.rm = TRUE), var.sca.df$p.value, mean(lat$SBDF, na.rm = TRUE), mean(form$SBDF, na.rm = TRUE), ttest.abs.BD$p.value, mean(abs.lat.BD, na.rm = TRUE), mean(abs.form.BD, na.rm = TRUE), ttest.abs.CPD$p.value, mean(abs.lat.CPD, na.rm = TRUE), mean(abs.form.CPD, na.rm = TRUE), ttest.abs.CPL$p.value, mean(abs.lat.CPL, na.rm = TRUE), mean(abs.form.CPL, na.rm = TRUE), ttest.abs.PreDL$p.value, mean(abs.lat.PreDL, na.rm = TRUE), mean(abs.form.PreDL, na.rm = TRUE), ttest.abs.DbL$p.value, mean(abs.lat.DbL, na.rm = TRUE), mean(abs.form.DbL, na.rm = TRUE), ttest.abs.HL$p.value, mean(abs.lat.HL, na.rm = TRUE), mean(abs.form.HL, na.rm = TRUE), ttest.abs.HD$p.value, mean(abs.lat.HD, na.rm = TRUE), mean(abs.form.HD, na.rm = TRUE), ttest.abs.HW$p.value, mean(abs.lat.HW, na.rm = TRUE), mean(abs.form.HW, na.rm = TRUE), ttest.abs.SnL$p.value, mean(abs.lat.SnL, na.rm = TRUE), mean(abs.form.SnL, na.rm = TRUE), ttest.abs.OL$p.value, mean(abs.lat.OL, na.rm = TRUE), mean(abs.form.OL, na.rm = TRUE), var.flu.asy$p.value, mean(lat$FLA, na.rm = TRUE), mean(form$FLA, na.rm = TRUE)), ncol=3, byrow=TRUE)

colnames(average.table)<- c('p-value for variance', 'lat mean', 'form mean')

rownames(average.table) <- c('dorsal rays', 'L pect rays', 'R pelvic rays', 'L pelvic rays', 'Anal rays', 'R pect rays', 'lat line scales', 'scales above LL', 'scales below LL', 'scales before dor', 'body dep', 'peduncle dep', 'peduncle leng', 'pre-dorsal', 'dorsal base', 'head length', 'head depth', 'head width', 'snout leng', 'orbital leng', 'fluct. asymmetries')

average.table


```


### Visualization of significant results {.tabset .tabset-fade .tabset-pills}

```{r}

plot_multi_histogram <- function(df, feature, label_column) {
    plt <- ggplot(df, aes(x=eval(parse(text=feature)), fill=eval(parse(text=label_column)))) +
    geom_histogram(bins=10, alpha=0.4, position="identity", aes(y = ..density..), color="black") +
    geom_density(alpha=0.2)  +
    labs(x=feature, y = "Density")
    plt + guides(fill=guide_legend(title=label_column))
}

plot_multi_histogram(raw2, "abs.res.P1.R", "SPP")

plot_multi_histogram(raw2, "abs.res.SBLL", "SPP")

plot_multi_histogram(raw2, "abs.res.DbL", "SPP")

plot_multi_histogram(raw2, "abs.res.HL", "SPP")

plot_multi_histogram(raw2, "FLA", "SPP")

plot_multi_histogram(raw2, "A", "SPP")


```




## ANOVA {.tabset .tabset-fade .tabset-pills}

Will run an ANOVA on the residuals with location and species as fixed effects. This will show me if morphology depends on the species, the location, and if the location and species interact to determine morphology. 

I will first run this using the zones as the location factor. Zones (1-4) represent the latitude range with equivalent sample sizes in each, since the collections were not equally representative of all latitudes, and I wanted to avoid a sampling bias when randomly selecting samples. Zone 1 corresponds to the southern most latitude range, and zone 4 corresponds to the northern most latitude range.

I will then run the same analysis using basin as the location faction. Since fish are physically isolated to the river basins they occupy, the genetic variation is also limited to that basin. Thus it is possible for fish within the same basin to be more similar due to genetic/physical constraints. (will also do with watershed just to see)

Lastly I will run ANOVAs with both zones and basins but with standardized residuals. This would allow me to compare overall variation across traits (at least those that are depended on body size) rather than just one trait at a time. Not 100% sure if this is useful (or correct to do), but thought it would be interesting. 

### Quartiles {.tabset .tabset-fade .tabset-pills}

```{r}

A.D <- aov(abs.res.D ~ SPP*QUARTILE, data=raw2)
summary(A.D)

A.P1 <- aov(abs.res.P1 ~ SPP*QUARTILE, data=raw2)
summary(A.P1)

A.P1.R <- aov(abs.res.P1.R ~ SPP*QUARTILE, data=raw2)
summary(A.P1.R)

A.LLSC <- aov(abs.res.LLSC ~ SPP*QUARTILE, data=raw2)
summary(A.LLSC)

A.SBLL <- aov(abs.res.SBLL ~ SPP*QUARTILE, data=raw2)
summary(A.SBLL)

A.BD <- aov(abs.res.BD ~ SPP*QUARTILE, data=raw2)
summary(A.BD)

A.CPD <- aov(abs.res.CPD ~ SPP*QUARTILE, data=raw2)
summary(A.CPD)

A.CPL <- aov(abs.res.CPL ~ SPP*QUARTILE, data=raw2)
summary(A.CPL)

A.PreDL <- aov(abs.res.PreDL ~ SPP*QUARTILE, data=raw2)
summary(A.PreDL)

A.DbL <- aov(abs.res.DbL ~ SPP*QUARTILE, data=raw2)
summary(A.DbL)

A.HL <- aov(abs.res.HL ~ SPP*QUARTILE, data=raw2)
summary(A.HL)

A.HD <- aov(abs.res.HD ~ SPP*QUARTILE, data=raw2)
summary(A.HD)

A.HW <- aov(abs.res.HW ~ SPP*QUARTILE, data=raw2)
summary(A.HW)

A.SnL <- aov(abs.res.SnL ~ SPP*QUARTILE, data=raw2)
summary(A.SnL)

A.OL <- aov(abs.res.OL ~ SPP*QUARTILE, data=raw2)
summary(A.OL)

A.A <- aov(A ~ SPP*QUARTILE, data=raw2)
summary(A.A)

A.SALL <- aov(SALL ~ SPP*QUARTILE, data=raw2)
summary(A.SALL)

A.SBDF <- aov(SBDF ~ SPP*QUARTILE, data=raw2)
summary(A.SBDF)

A.FLA <- aov(FLA ~ SPP*QUARTILE, data=raw2)
summary(A.FLA)

#visualizing significant results

library(ggplot2)

ggplot(raw2, aes(x=factor(QUARTILE), y=FLA, fill=SPP)) + geom_boxplot()


ggplot(raw2, aes(x=factor(QUARTILE), y=abs.res.D, fill=SPP)) +
  geom_boxplot()


ggplot(raw2, aes(x=factor(QUARTILE), y=abs.res.P1.R, fill=SPP)) +
  geom_boxplot()

```


### Basins {.tabset .tabset-fade .tabset-pills}

```{r}

A1.D <- aov(abs.res.D ~ SPP*BASIN, data=raw2)
summary(A.D)

A1.P1 <- aov(abs.res.P1 ~ SPP*BASIN, data=raw2)
summary(A.P1)

A1.P1.R <- aov(abs.res.P1.R ~ SPP*BASIN, data=raw2)
summary(A.P1.R)

A1.LLSC <- aov(abs.res.LLSC ~ SPP*BASIN, data=raw2)
summary(A.LLSC)

A1.SBLL <- aov(abs.res.SBLL ~ SPP*BASIN, data=raw2)
summary(A.SBLL)

A1.BD <- aov(abs.res.BD ~ SPP*BASIN, data=raw2)
summary(A.BD)

A1.CPD <- aov(abs.res.CPD ~ SPP*BASIN, data=raw2)
summary(A.CPD)

A1.CPL <- aov(abs.res.CPL ~ SPP*BASIN, data=raw2)
summary(A.CPL)

A1.PreDL <- aov(abs.res.PreDL ~ SPP*BASIN, data=raw2)
summary(A.PreDL)

A1.DbL <- aov(abs.res.DbL ~ SPP*BASIN, data=raw2)
summary(A.DbL)

A1.HL <- aov(abs.res.HL ~ SPP*BASIN, data=raw2)
summary(A.HL)

A1.HD <- aov(abs.res.HD ~ SPP*BASIN, data=raw2)
summary(A.HD)

A1.HW <- aov(abs.res.HW ~ SPP*BASIN, data=raw2)
summary(A.HW)

A1.SnL <- aov(abs.res.SnL ~ SPP*BASIN, data=raw2)
summary(A.SnL)

A1.OL <- aov(abs.res.OL ~ SPP*BASIN, data=raw2)
summary(A.OL)

A1.A <- aov(A ~ SPP*BASIN, data=raw2)
summary(A.A)

A1.SALL <- aov(SALL ~ SPP*BASIN, data=raw2)
summary(A.SALL)

A1.SBDF <- aov(SBDF ~ SPP*BASIN, data=raw2)
summary(A.SBDF)

A1.FLA <- aov(FLA ~ SPP*BASIN, data=raw2)
summary(A.FLA)

#visualizing significant results



```


### Watersheds {.tabset .tabset-fade .tabset-pills}

```{r}

A2.D <- aov(abs.res.D ~ SPP*WATERSHED, data=raw2)
summary(A.D)

A2.P1 <- aov(abs.res.P1 ~ SPP*WATERSHED, data=raw2)
summary(A.P1)

A2.P1.R <- aov(abs.res.P1.R ~ SPP*WATERSHED, data=raw2)
summary(A.P1.R)

A2.LLSC <- aov(abs.res.LLSC ~ SPP*WATERSHED, data=raw2)
summary(A.LLSC)

A2.SBLL <- aov(abs.res.SBLL ~ SPP*WATERSHED, data=raw2)
summary(A.SBLL)

A2.BD <- aov(abs.res.BD ~ SPP*WATERSHED, data=raw2)
summary(A.BD)

A2.CPD <- aov(abs.res.CPD ~ SPP*WATERSHED, data=raw2)
summary(A.CPD)

A2.CPL <- aov(abs.res.CPL ~ SPP*WATERSHED, data=raw2)
summary(A.CPL)

A2.PreDL <- aov(abs.res.PreDL ~ SPP*WATERSHED, data=raw2)
summary(A.PreDL)

A2.DbL <- aov(abs.res.DbL ~ SPP*WATERSHED, data=raw2)
summary(A.DbL)

A2.HL <- aov(abs.res.HL ~ SPP*WATERSHED, data=raw2)
summary(A.HL)

A2.HD <- aov(abs.res.HD ~ SPP*WATERSHED, data=raw2)
summary(A.HD)

A2.HW <- aov(abs.res.HW ~ SPP*WATERSHED, data=raw2)
summary(A.HW)

A2.SnL <- aov(abs.res.SnL ~ SPP*WATERSHED, data=raw2)
summary(A.SnL)

A2.OL <- aov(abs.res.OL ~ SPP*WATERSHED, data=raw2)
summary(A.OL)

A2.A <- aov(A ~ SPP*WATERSHED, data=raw2)
summary(A.A)

A2.SALL <- aov(SALL ~ SPP*WATERSHED, data=raw2)
summary(A.SALL)

A2.SBDF <- aov(SBDF ~ SPP*WATERSHED, data=raw2)
summary(A.SBDF)

A2.FLA <- aov(FLA ~ SPP*WATERSHED, data=raw2)
summary(A.FLA)

#visualizing significant results



```



### Standardized {.tabset .tabset-fade .tabset-pills}



sd.res.D <- append(sd.lat.D1, sd.form.D1)
sd.res.P1 <- append(sd.lat.P11, sd.form.P11)
sd.res.P1.R <- append(sd.lat.P1.R1, sd.form.P1.R1)
sd.res.LLSC<- append(sd.lat.LLSC1, sd.form.LLSC1)
sd.res.SBLL<- append(sd.lat.SBLL1, sd.form.SBLL1)
sd.res.BD<- append(sd.lat.BD1, sd.form.BD1)
sd.res.CPD<- append(sd.lat.CPD1, sd.form.CPD1)
sd.res.CPL<- append(sd.lat.CPL1, sd.form.CPL1)
sd.res.PreDL <- append(sd.lat.PreDL1, sd.form.PreDL1)
sd.res.DbL <- append(sd.lat.DbL1, sd.form.DbL1)
sd.res.HL<- append(sd.lat.HL1, sd.form.HL1)
sd.res.HD<- append(sd.lat.HD1, sd.form.HD1)
sd.res.HW <- append(sd.lat.HW1, sd.form.HW1)
sd.res.SnL <- append(sd.lat.SnL1, sd.form.SnL1)
sd.res.OL <- append(sd.lat.OL1, sd.form.OL1)

raw3 <- cbind(raw2, sd.res.D, sd.res.P1, sd.res.P1.R, sd.res.LLSC, sd.res.SBLL, sd.res.BD, sd.res.CPD, sd.res.CPL, sd.res.PreDL, sd.res.DbL, sd.res.HL, sd.res.HD, sd.res.HW, sd.res.SnL, sd.res.OL)


library(dplyr)
raw3a <- raw3 %>%
  select(49:63) %>%
  abs()

raw3a <- cbind(raw3, raw3a)

raw3b <- cbind(raw3a[1:32], stack(raw3a[49:78])) 
raw3b$abs_sd = abs(raw3b$values)

lat.raw3 <- raw3b[raw3b$SPP == "p.latipinna",]

form.raw3 <- raw3b[raw3b$SPP == "p.formosa",]

######QUARTILES#####

A3.lat <- aov(abs_sd~QUARTILE, data=lat.raw3)
summary(A3.lat)

A3.form <- aov(abs_sd~QUARTILE, data=form.raw3)
summary(A3.form)

#between species

A3 <- aov(abs_sd~QUARTILE*SPP, data=raw3b)
summary(A3)


######BASINS#####

A4.lat <- aov(abs_sd~BASIN, data=lat.raw3)
summary(A4.lat)

A4.form <- aov(abs_sd~BASIN, data=form.raw3)
summary(A4.form)

#between species

A4 <- aov(abs_sd~BASIN*SPP, data=raw3b)
summary(A4)


#####WATERSHEDS#####
A5.lat <- aov(abs_sd~WATERSHED, data=lat.raw3)
summary(A5.lat)

A5.form <- aov(abs_sd~WATERSHED, data=form.raw3)
summary(A5.form)

#between species

A5 <- aov(abs_sd~WATERSHED*SPP, data=raw3b)
summary(A5)







## PCA analysis {.tabset .tabset-fade .tabset-pills}

LOGAN: CHECK THAT EACH VARIABLES IS NEAR NORMALLY DISTRIBUTED. IF NOT, LOG TRANSFORM BEFORE PCA. ALSO CHECK THAT PCA CALCULATES Z SCORES AND PLOTS BASED ON THAT; IF NOT CONVERT TO Z SCORES THEN RUN PCA.

In this analysis, I will compare the principle components after centering and scaling the data. A PCA analysis will help us determine what aspects of morphology influence the variation in our data the most without worrying about differences in scales/measurements. Currently, data consists of **116 Sailfin and 186 Amazon**. 



*Variable chart:*

  - D: dorsal ray count
  - P1: left pectoral ray count
  - P2.L: left pelvic rays
  - P2.R: right pelvic rays
  - A: anal rays
  - P1.R: right pectoral ray count
  - LLSC: lateral line scale count
  - SALL: scales above lateral line
  - SBLL: scales below lateral line
  - SBDF: scales before dorsal fin
  - TL: total length
  - SL: standard length
  - BD: body depth
  - CPD: caudal peduncle depth
  - CPL: caudal peduncle length
  - PreDL: pre-dorsal length
  - DbL: dorsal base length
  - HL/HW/HD: head length/width/depth
  - SnL: snout length
  - OL: ocular length

-   summary of PCs

{r, echo=FALSE}

PCA <- prcomp(raw1[, 10:31], center=TRUE, scale. = TRUE) #includes all 22 traits 
summary(PCA)
loadings <- PCA$rotation
loadings[, 1:5]


VM_PCA <- varimax(PCA$rotation)
summary(VM_PCA)



-   visualization of PCA

{r, echo=FALSE}

library(AMR)
library(ggplot2)


library(ggfortify)

evplot <- function(ev)
{
	# Broken stick model (MacArthur 1957)
	n <- length(ev)
	bsm <- data.frame(j=seq(1:n), p=0)
	bsm$p[1] <- 1/n
	for (i in 2:n) bsm$p[i] <- bsm$p[i-1] + (1/(n + 1 - i))
	bsm$p <- 100*bsm$p/n
	# Plot eigenvalues and % of variation for each axis
	op <- par(mfrow=c(2,1))
	barplot(ev, main="Eigenvalues", col="bisque", las=2)
	abline(h=mean(ev), col="red")
	legend("topright", "Average eigenvalue", lwd=1, col=2, bty="n")
	barplot(t(cbind(100*ev/sum(ev), bsm$p[n:1])), beside=TRUE, 
		main="% variation", col=c("bisque",2), las=2)
	legend("topright", c("% eigenvalue", "Broken stick model"), 
		pch=15, col=c("bisque",2), bty="n")
	par(op)
}

ev <- PCA$sdev^2
evplot(ev) #according to Kaiser-Guttman criteron, we can use the first 4 PCs, even though the broken stick model shows only the first above the red bar plot... not 100% confident I know what this means, but pretty sure PC1 is body size 

plot6<- autoplot(PCA, data = raw1, colour='SPP', loadings=TRUE, loadings.colour='navyblue', loadings.label=TRUE, loadings.label.colour='navyblue', loadings.label.size=5, loadings.label.vjust= 1, loadings.label.hjust= 1.2, frame=TRUE, frame.type='norm')+ ggtitle("PCA Plot of Morphology traits") + theme_minimal()
plot6

plot6.1<- autoplot(PCA, data = raw1, colour='SPP', loadings=FALSE, loadings.label=FALSE, frame=TRUE, frame.type='norm')+ ggtitle("PCA Plot of Morphology traits") + theme_minimal()
plot6.1


plot7<- autoplot(PCA, data = raw1, colour='QUARTILE', shape="SPP", frame=TRUE, frame.type='norm')+ ggtitle("PCA Plot of Morphology traits") + theme_minimal()
plot7

plot7A<- autoplot(PCA, data = raw1, colour='BASIN', shape="SPP", frame=TRUE, frame.type='norm')+ ggtitle("PCA Plot of Morphology traits") + theme_minimal()
plot7A

plot7B<- autoplot(PCA, data = raw1, colour='WATERSHED', shape="SPP", frame=TRUE, frame.type='norm')+ ggtitle("PCA Plot of Morphology traits") + theme_minimal()
plot7B


plot8<- autoplot(PCA, x=2, y=3, data = raw1, colour='SPP', loadings=TRUE, loadings.colour='navyblue', loadings.label=TRUE, loadings.label.colour='navyblue', loadings.label.size=5, loadings.label.vjust= 1, loadings.label.hjust= 1.2, frame=TRUE, frame.type='norm')+ ggtitle("PCA Plot of Morphology traits") + theme_minimal()
plot8

plot8.1<- autoplot(PCA, x=2, y=3, data = raw1, colour='SPP', loadings=FALSE, loadings.label=FALSE, frame=TRUE, frame.type='norm')+ ggtitle("PCA Plot of Morphology traits") + theme_minimal()
plot8.1


plot9<- autoplot(PCA, x=2, y=3, data = raw1, colour='QUARTILE', shape="SPP", frame=TRUE, frame.type='norm')+ ggtitle("PCA Plot of Morphology traits") + theme_minimal()
plot9

plot9A<- autoplot(PCA, x=2, y=3, data = raw1, colour='BASIN', shape="SPP", frame=TRUE, frame.type='norm')+ ggtitle("PCA Plot of Morphology traits") + theme_minimal()
plot9A

plot9B<- autoplot(PCA, x=2, y=3, data = raw1, colour='WATERSHED', shape="SPP", frame=TRUE, frame.type='norm')+ ggtitle("PCA Plot of Morphology traits") + theme_minimal()
plot9B


##### PCA FOR RESITUDALS ######
# not sure this is useful, but will have it here just in case

PCA2 <- prcomp(raw2[, 33:48], center=TRUE, scale. = TRUE) #includes all 22 traits 
summary(PCA2)
loadings1 <- PCA2$rotation
loadings1[, 1:5]

plot10<- autoplot(PCA2, x=1, y=2, data = raw2, colour='SPP', loadings=TRUE, loadings.colour='navyblue', loadings.label=TRUE, loadings.label.colour='navyblue', loadings.label.size=5, loadings.label.vjust= 1, loadings.label.hjust= 1.2, frame=TRUE, frame.type='norm')+ ggtitle("PCA Plot of Morphology trait Residuals") + theme_minimal()
plot10

plot11<- autoplot(PCA2, x=1, y=2, data = raw2, colour='SPP', loadings=FALSE, loadings.label=FALSE, frame=TRUE, frame.type='norm')+ ggtitle("PCA Plot of Morphology traits") + theme_minimal()
plot11





*Variable chart:*

  - D: dorsal ray count
  - P1: left pectoral ray count
  - P2.L: left pelvic rays
  - P2.R: right pelvic rays
  - A: anal rays
  - P1.R: right pectoral ray count
  - LLSC: lateral line scale count
  - SALL: scales above lateral line
  - SBLL: scales below lateral line
  - SBDF: scales before dorsal fin
  - TL: total length
  - SL: standard length
  - BD: body depth
  - CPD: caudal peduncle depth
  - CPL: caudal peduncle length
  - PreDL: pre-dorsal length
  - DbL: dorsal base length
  - HL/HW/HD: head length/width/depth
  - SnL: snout length
  - OL: ocular length
  
  